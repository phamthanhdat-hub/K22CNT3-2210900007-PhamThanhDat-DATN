<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Admin â€“ Quáº£n lÃ½ Ä‘Æ¡n hÃ ng</title>
<link rel="stylesheet" href="../css/style.css">
</head>
<body>

<h2>ğŸ“¦ Quáº£n lÃ½ Ä‘Æ¡n hÃ ng</h2>

<table border="1" cellpadding="10" width="100%">
<thead>
<tr>
    <th>ID</th>
    <th>KhÃ¡ch hÃ ng</th>
    <th>Äiá»‡n thoáº¡i</th>
    <th>Tá»•ng tiá»n</th>
    <th>Tráº¡ng thÃ¡i</th>
    <th>HÃ nh Ä‘á»™ng</th>
</tr>
</thead>
<tbody id="donHangBody"></tbody>
</table>

<script>
fetch("http://127.0.0.1:5000/api/admin/don-hang")
.then(res => res.json())
.then(data => {
    const body = document.getElementById("donHangBody");
    body.innerHTML = "";

    data.forEach(dh => {
        body.innerHTML += `
        <tr>
            <td>${dh.id}</td>
            <td>${dh.hoTen}</td>
            <td>${dh.dienThoai}</td>
            <td>${dh.tongTien.toLocaleString()}Ä‘</td>
            <td>
                <select onchange="capNhat(${dh.id}, this.value)">
                    <option ${dh.trangThai=="Chá» xÃ¡c nháº­n"?"selected":""}>Chá» xÃ¡c nháº­n</option>
                    <option ${dh.trangThai=="Äang giao"?"selected":""}>Äang giao</option>
                    <option ${dh.trangThai=="HoÃ n thÃ nh"?"selected":""}>HoÃ n thÃ nh</option>
                    <option ${dh.trangThai=="ÄÃ£ há»§y"?"selected":""}>ÄÃ£ há»§y</option>
                </select>
            </td>
            <td>
                <button onclick="xemChiTiet(${dh.id})">ğŸ‘ Xem</button>
            </td>
        </tr>
        `;
    });
});

function capNhat(id, trangThai) {
    fetch(`http://127.0.0.1:5000/api/admin/don-hang/${id}/trang-thai`, {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ trangThai })
    })
    .then(() => alert("âœ”ï¸ Cáº­p nháº­t thÃ nh cÃ´ng"));
}

function xemChiTiet(id) {
    window.location.href = `admin-chi-tiet-don.html?id=${id}`;
}
</script>

</body>
</html>
