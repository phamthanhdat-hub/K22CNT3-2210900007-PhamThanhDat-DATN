<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω khuy·∫øn m√£i | Admin BabyCutie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .promo-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(255,246,248,0.95));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(255,107,129,0.15);
            border: 2px solid rgba(255,107,129,0.1);
            transition: all 0.4s ease;
        }
        
        .promo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255,107,129,0.25);
            border-color: rgba(255,107,129,0.3);
        }
        
        .promo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,107,129,0.1);
        }
        
        .promo-code {
            background: linear-gradient(135deg, #ff6b81, #ff8fa3);
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 18px;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(255,107,129,0.3);
        }
        
        .promo-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 13px;
        }
        
        .status-active {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .status-inactive {
            background: #6c757d;
            color: white;
        }
        
        .promo-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .promo-detail-item {
            background: rgba(255,255,255,0.7);
            padding: 12px;
            border-radius: 10px;
            border-left: 4px solid #ff6b81;
        }
        
        .promo-detail-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .promo-detail-value {
            font-size: 16px;
            color: #333;
            font-weight: 700;
        }
        
        .btn-action-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-action-group .btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-action-group .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn-add-promo {
            background: linear-gradient(135deg, #ff6b81, #ff8fa3);
            color: white;
            padding: 12px 30px;
            border-radius: 15px;
            font-weight: 700;
            border: none;
            box-shadow: 0 4px 15px rgba(255,107,129,0.3);
            transition: all 0.3s ease;
        }
        
        .btn-add-promo:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,129,0.4);
        }
        
        .modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #ff6b81, #ff8fa3);
            color: white;
            border-radius: 20px 20px 0 0;
            padding: 20px 30px;
        }
        
        .modal-header .btn-close {
            filter: brightness(0) invert(1);
        }
        
        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #ff6b81;
            box-shadow: 0 0 0 0.2rem rgba(255,107,129,0.25);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        #toastContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
    </style>
</head>
<body>

<header class="header">
    <div class="container header-wrap">
        <div class="logo" onclick="location='admin-dashboard.html'">
            <span>üõ† Qu·∫£n l√Ω khuy·∫øn m√£i</span>
        </div>
        <button class="btn-login" onclick="location='admin-dashboard.html'">‚Üê Dashboard</button>
    </div>
</header>

<section class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 style="color: #ff6b81; font-weight: 700;">üè∑Ô∏è Danh s√°ch khuy·∫øn m√£i</h2>
        <button class="btn btn-add-promo" onclick="openForm()">
            <i class="fas fa-plus"></i> Th√™m khuy·∫øn m√£i
        </button>
    </div>

    <div id="promoList">
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">ƒêang t·∫£i...</span>
            </div>
        </div>
    </div>
</section>

<!-- Toast Container -->
<div id="toastContainer"></div>

<!-- MODAL -->
<div class="modal fade" id="khuyenMaiModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-tag"></i> 
                    <span id="modalTitle">Th√™m khuy·∫øn m√£i m·ªõi</span>
                </h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="khuyenMaiId">
                <div id="errorMessage" class="alert alert-danger" style="display: none;"></div>
                
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">T√™n khuy·∫øn m√£i *</label>
                        <input class="form-control" id="tenKhuyenMai" placeholder="V√≠ d·ª•: Gi·∫£m 10% cho kh√°ch m·ªõi" required>
                        <small class="text-muted">T·ªëi thi·ªÉu 3 k√Ω t·ª±</small>
                    </div>
                    <div class="col-md-12 mb-3">
                        <label class="form-label">M√£ khuy·∫øn m√£i *</label>
                        <input class="form-control" id="maKhuyenMai" placeholder="V√≠ d·ª•: WELCOME10" style="text-transform: uppercase;" required>
                        <small class="text-muted">T·ªëi thi·ªÉu 3 k√Ω t·ª±, vi·∫øt hoa</small>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Lo·∫°i gi·∫£m gi√° *</label>
                        <select class="form-select" id="loaiGiamGia" required onchange="updateGiamGiaType()">
                            <option value="phan_tram">Ph·∫ßn trƒÉm (%)</option>
                            <option value="tien_mat">Ti·ªÅn m·∫∑t (ƒë)</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Gi√° tr·ªã gi·∫£m *</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="giaTriGiam" placeholder="0" min="0" step="0.01" required>
                            <span class="input-group-text" id="giaTriUnit">%</span>
                        </div>
                        <small class="text-muted" id="giaTriHint">Nh·∫≠p ph·∫ßn trƒÉm (1-100%)</small>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3" id="giaTriToiDaContainer">
                        <label class="form-label">Gi√° tr·ªã t·ªëi ƒëa (n·∫øu gi·∫£m %)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="giaTriToiDa" placeholder="0" min="0" step="1000">
                            <span class="input-group-text">ƒë</span>
                        </div>
                        <small class="text-muted">Gi·ªõi h·∫°n s·ªë ti·ªÅn gi·∫£m t·ªëi ƒëa</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">ƒê∆°n h√†ng t·ªëi thi·ªÉu</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="donHangToiThieu" placeholder="0" min="0" step="1000">
                            <span class="input-group-text">ƒë</span>
                        </div>
                        <small class="text-muted">S·ªë ti·ªÅn t·ªëi thi·ªÉu ƒë·ªÉ √°p d·ª•ng</small>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Ng√†y b·∫Øt ƒë·∫ßu</label>
                        <input type="datetime-local" class="form-control" id="ngayBatDau">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Ng√†y k·∫øt th√∫c</label>
                        <input type="datetime-local" class="form-control" id="ngayKetThuc">
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="trangThai" checked style="width: 50px; height: 25px;">
                        <label class="form-check-label" for="trangThai" style="font-weight: 600; margin-left: 10px;">
                            Ho·∫°t ƒë·ªông
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> H·ªßy
                </button>
                <button class="btn btn-primary" onclick="saveKhuyenMai()" id="saveBtn">
                    <i class="fas fa-save"></i> L∆∞u
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const API_URL = "http://127.0.0.1:5000/api/admin/khuyen-mai";
let modal = null;

// Check authentication
if (!localStorage.getItem("admin_token")) {
    window.location.href = "login-admin.html";
}

// Initialize modal
document.addEventListener('DOMContentLoaded', function() {
    modal = new bootstrap.Modal(document.getElementById("khuyenMaiModal"));
    loadKhuyenMai();
    updateGiamGiaType();
});

// Toast notification function
function showToast(message, type = "success") {
    const toastContainer = document.getElementById("toastContainer");
    const toastId = "toast-" + Date.now();
    const bgColor = type === "success" ? "#28a745" : type === "error" ? "#dc3545" : "#ffc107";
    const icon = type === "success" ? "check-circle" : type === "error" ? "exclamation-circle" : "info-circle";
    
    const toastHTML = `
        <div id="${toastId}" class="toast align-items-center text-white bg-${type === "success" ? "success" : type === "error" ? "danger" : "warning"} border-0" role="alert" style="min-width: 300px;">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-${icon} me-2"></i>${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML("beforeend", toastHTML);
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
    toast.show();
    
    toastElement.addEventListener('hidden.bs.toast', function() {
        toastElement.remove();
    });
}

// Update discount type UI
function updateGiamGiaType() {
    const loaiGiamGia = document.getElementById("loaiGiamGia").value;
    const giaTriUnit = document.getElementById("giaTriUnit");
    const giaTriHint = document.getElementById("giaTriHint");
    const giaTriToiDaContainer = document.getElementById("giaTriToiDaContainer");
    const giaTriGiam = document.getElementById("giaTriGiam");
    
    if (loaiGiamGia === "phan_tram") {
        giaTriUnit.textContent = "%";
        giaTriHint.textContent = "Nh·∫≠p ph·∫ßn trƒÉm (1-100%)";
        giaTriGiam.setAttribute("max", "100");
        giaTriGiam.setAttribute("min", "1");
        giaTriToiDaContainer.style.display = "block";
    } else {
        giaTriUnit.textContent = "ƒë";
        giaTriHint.textContent = "Nh·∫≠p s·ªë ti·ªÅn gi·∫£m (VNƒê)";
        giaTriGiam.removeAttribute("max");
        giaTriGiam.setAttribute("min", "0");
        giaTriToiDaContainer.style.display = "none";
    }
}

// Load all promotions
function loadKhuyenMai() {
    const promoList = document.getElementById("promoList");
    
    fetch(API_URL, {
        headers: {
            "Authorization": `Bearer ${localStorage.getItem("admin_token")}`
        }
    })
    .then(res => {
        if (!res.ok) throw new Error("L·ªói k·∫øt n·ªëi");
        return res.json();
    })
    .then(data => {
        promoList.innerHTML = "";
        
        if (!data || data.length === 0) {
            promoList.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-tag"></i>
                    <h4>Ch∆∞a c√≥ khuy·∫øn m√£i n√†o</h4>
                    <p>H√£y th√™m khuy·∫øn m√£i m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
                </div>
            `;
            return;
        }
        
        data.forEach((km) => {
            const loai = km.loaiGiamGia === 'phan_tram' 
                ? `${km.giaTriGiam}%` 
                : `${new Intl.NumberFormat('vi-VN').format(km.giaTriGiam)}ƒë`;
            
            const ngayBatDau = km.ngayBatDau 
                ? new Date(km.ngayBatDau).toLocaleString('vi-VN') 
                : 'Kh√¥ng gi·ªõi h·∫°n';
            const ngayKetThuc = km.ngayKetThuc 
                ? new Date(km.ngayKetThuc).toLocaleString('vi-VN') 
                : 'Kh√¥ng gi·ªõi h·∫°n';
            
            const promoCard = document.createElement("div");
            promoCard.className = "promo-card";
            promoCard.innerHTML = `
                <div class="promo-header">
                    <div class="promo-code">${km.maKhuyenMai}</div>
                    <span class="promo-status ${km.trangThai ? 'status-active' : 'status-inactive'}">
                        ${km.trangThai ? '‚úì Ho·∫°t ƒë·ªông' : '‚úó T·∫°m d·ª´ng'}
                    </span>
                </div>
                <h5 style="color: #333; margin-bottom: 15px; font-weight: 700;">${km.tenKhuyenMai}</h5>
                <div class="promo-details">
                    <div class="promo-detail-item">
                        <div class="promo-detail-label">Lo·∫°i gi·∫£m gi√°</div>
                        <div class="promo-detail-value">${km.loaiGiamGia === 'phan_tram' ? 'Ph·∫ßn trƒÉm' : 'Ti·ªÅn m·∫∑t'}</div>
                    </div>
                    <div class="promo-detail-item">
                        <div class="promo-detail-label">Gi√° tr·ªã gi·∫£m</div>
                        <div class="promo-detail-value" style="color: #ff6b81;">${loai}</div>
                    </div>
                    <div class="promo-detail-item">
                        <div class="promo-detail-label">ƒê∆°n t·ªëi thi·ªÉu</div>
                        <div class="promo-detail-value">${km.donHangToiThieu ? new Intl.NumberFormat('vi-VN').format(km.donHangToiThieu) + 'ƒë' : 'Kh√¥ng'}</div>
                    </div>
                    <div class="promo-detail-item">
                        <div class="promo-detail-label">Gi√° tr·ªã t·ªëi ƒëa</div>
                        <div class="promo-detail-value">${km.giaTriToiDa ? new Intl.NumberFormat('vi-VN').format(km.giaTriToiDa) + 'ƒë' : 'Kh√¥ng'}</div>
                    </div>
                    <div class="promo-detail-item">
                        <div class="promo-detail-label">Ng√†y b·∫Øt ƒë·∫ßu</div>
                        <div class="promo-detail-value">${ngayBatDau}</div>
                    </div>
                    <div class="promo-detail-item">
                        <div class="promo-detail-label">Ng√†y k·∫øt th√∫c</div>
                        <div class="promo-detail-value">${ngayKetThuc}</div>
                    </div>
                </div>
                <div class="btn-action-group">
                    <button class="btn btn-warning" onclick="editKhuyenMai(${km.id})">
                        <i class="fas fa-edit"></i> S·ª≠a
                    </button>
                    <button class="btn btn-danger" onclick="deleteKhuyenMai(${km.id})">
                        <i class="fas fa-trash"></i> X√≥a
                    </button>
                </div>
            `;
            promoList.appendChild(promoCard);
        });
    })
    .catch(error => {
        showToast("L·ªói khi t·∫£i danh s√°ch khuy·∫øn m√£i: " + error.message, "error");
        promoList.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-exclamation-triangle"></i>
                <h4>L·ªói khi t·∫£i d·ªØ li·ªáu</h4>
                <p>${error.message}</p>
            </div>
        `;
    });
}

// Open form for adding new promotion
function openForm() {
    document.getElementById("modalTitle").textContent = "Th√™m khuy·∫øn m√£i m·ªõi";
    document.getElementById("khuyenMaiId").value = "";
    document.getElementById("tenKhuyenMai").value = "";
    document.getElementById("maKhuyenMai").value = "";
    document.getElementById("loaiGiamGia").value = "phan_tram";
    document.getElementById("giaTriGiam").value = "";
    document.getElementById("giaTriToiDa").value = "";
    document.getElementById("donHangToiThieu").value = "";
    document.getElementById("ngayBatDau").value = "";
    document.getElementById("ngayKetThuc").value = "";
    document.getElementById("trangThai").checked = true;
    document.getElementById("errorMessage").style.display = "none";
    updateGiamGiaType();
    modal.show();
}

// Edit promotion
function editKhuyenMai(id) {
    fetch(`${API_URL}/${id}`, {
        headers: {
            "Authorization": `Bearer ${localStorage.getItem("admin_token")}`
        }
    })
    .then(res => res.json())
    .then(result => {
        if (!result.success) {
            showToast(result.message || "Kh√¥ng t√¨m th·∫•y khuy·∫øn m√£i", "error");
            return;
        }
        
        const km = result.data;
        document.getElementById("modalTitle").textContent = "S·ª≠a khuy·∫øn m√£i";
        document.getElementById("khuyenMaiId").value = km.id;
        document.getElementById("tenKhuyenMai").value = km.tenKhuyenMai;
        document.getElementById("maKhuyenMai").value = km.maKhuyenMai;
        document.getElementById("loaiGiamGia").value = km.loaiGiamGia;
        document.getElementById("giaTriGiam").value = km.giaTriGiam;
        document.getElementById("giaTriToiDa").value = km.giaTriToiDa || "";
        document.getElementById("donHangToiThieu").value = km.donHangToiThieu || "";
        
        if (km.ngayBatDau) {
            const date = new Date(km.ngayBatDau);
            document.getElementById("ngayBatDau").value = date.toISOString().slice(0, 16);
        } else {
            document.getElementById("ngayBatDau").value = "";
        }
        
        if (km.ngayKetThuc) {
            const date = new Date(km.ngayKetThuc);
            document.getElementById("ngayKetThuc").value = date.toISOString().slice(0, 16);
        } else {
            document.getElementById("ngayKetThuc").value = "";
        }
        
        document.getElementById("trangThai").checked = km.trangThai;
        document.getElementById("errorMessage").style.display = "none";
        updateGiamGiaType();
        modal.show();
    })
    .catch(error => {
        showToast("L·ªói khi t·∫£i th√¥ng tin khuy·∫øn m√£i: " + error.message, "error");
    });
}

// Save promotion (create or update)
function saveKhuyenMai() {
    const errorMsg = document.getElementById("errorMessage");
    errorMsg.style.display = "none";
    
    // Validation
    const tenKhuyenMai = document.getElementById("tenKhuyenMai").value.trim();
    const maKhuyenMai = document.getElementById("maKhuyenMai").value.trim().toUpperCase();
    const loaiGiamGia = document.getElementById("loaiGiamGia").value;
    const giaTriGiam = parseFloat(document.getElementById("giaTriGiam").value);
    const giaTriToiDa = document.getElementById("giaTriToiDa").value ? parseFloat(document.getElementById("giaTriToiDa").value) : null;
    const donHangToiThieu = document.getElementById("donHangToiThieu").value ? parseFloat(document.getElementById("donHangToiThieu").value) : null;
    const ngayBatDau = document.getElementById("ngayBatDau").value || null;
    const ngayKetThuc = document.getElementById("ngayKetThuc").value || null;
    const trangThai = document.getElementById("trangThai").checked;
    
    if (!tenKhuyenMai || tenKhuyenMai.length < 3) {
        errorMsg.textContent = "T√™n khuy·∫øn m√£i ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±";
        errorMsg.style.display = "block";
        return;
    }
    
    if (!maKhuyenMai || maKhuyenMai.length < 3) {
        errorMsg.textContent = "M√£ khuy·∫øn m√£i ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±";
        errorMsg.style.display = "block";
        return;
    }
    
    if (!giaTriGiam || giaTriGiam <= 0) {
        errorMsg.textContent = "Gi√° tr·ªã gi·∫£m ph·∫£i l·ªõn h∆°n 0";
        errorMsg.style.display = "block";
        return;
    }
    
    if (loaiGiamGia === "phan_tram" && (giaTriGiam < 1 || giaTriGiam > 100)) {
        errorMsg.textContent = "Ph·∫ßn trƒÉm gi·∫£m gi√° ph·∫£i t·ª´ 1% ƒë·∫øn 100%";
        errorMsg.style.display = "block";
        return;
    }
    
    if (ngayBatDau && ngayKetThuc && new Date(ngayKetThuc) < new Date(ngayBatDau)) {
        errorMsg.textContent = "Ng√†y k·∫øt th√∫c ph·∫£i sau ng√†y b·∫Øt ƒë·∫ßu";
        errorMsg.style.display = "block";
        return;
    }
    
    const id = document.getElementById("khuyenMaiId").value;
    const data = {
        tenKhuyenMai: tenKhuyenMai,
        maKhuyenMai: maKhuyenMai,
        loaiGiamGia: loaiGiamGia,
        giaTriGiam: giaTriGiam,
        giaTriToiDa: giaTriToiDa,
        donHangToiThieu: donHangToiThieu,
        ngayBatDau: ngayBatDau,
        ngayKetThuc: ngayKetThuc,
        trangThai: trangThai
    };

    const url = id ? `${API_URL}/${id}` : API_URL;
    const method = id ? "PUT" : "POST";
    const saveBtn = document.getElementById("saveBtn");
    const originalText = saveBtn.innerHTML;
    
    // Show loading state
    saveBtn.disabled = true;
    saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang l∆∞u...';

    fetch(url, {
        method: method,
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${localStorage.getItem("admin_token")}`
        },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(result => {
        if (result.success) {
            showToast(id ? "C·∫≠p nh·∫≠t khuy·∫øn m√£i th√†nh c√¥ng!" : "Th√™m khuy·∫øn m√£i th√†nh c√¥ng!", "success");
            modal.hide();
            loadKhuyenMai();
        } else {
            errorMsg.textContent = result.message || "C√≥ l·ªói x·∫£y ra";
            errorMsg.style.display = "block";
            showToast(result.message || "C√≥ l·ªói x·∫£y ra", "error");
        }
    })
    .catch(error => {
        errorMsg.textContent = "L·ªói k·∫øt n·ªëi: " + error.message;
        errorMsg.style.display = "block";
        showToast("L·ªói k·∫øt n·ªëi: " + error.message, "error");
    })
    .finally(() => {
        saveBtn.disabled = false;
        saveBtn.innerHTML = originalText;
    });
}

// Delete promotion
function deleteKhuyenMai(id) {
    if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a khuy·∫øn m√£i n√†y?\n\nL∆∞u √Ω: Kh√¥ng th·ªÉ x√≥a khuy·∫øn m√£i ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng trong ƒë∆°n h√†ng.")) {
        return;
    }
    
    fetch(`${API_URL}/${id}`, {
        method: "DELETE",
        headers: {
            "Authorization": `Bearer ${localStorage.getItem("admin_token")}`
        }
    })
    .then(res => res.json())
    .then(result => {
        if (result.success) {
            showToast("X√≥a khuy·∫øn m√£i th√†nh c√¥ng!", "success");
            loadKhuyenMai();
        } else {
            showToast(result.message || "Kh√¥ng th·ªÉ x√≥a khuy·∫øn m√£i n√†y", "error");
        }
    })
    .catch(error => {
        showToast("L·ªói khi x√≥a khuy·∫øn m√£i: " + error.message, "error");
    });
}
</script>

</body>
</html>

