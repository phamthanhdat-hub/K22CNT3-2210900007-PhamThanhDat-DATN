<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ƒê∆°n h√†ng c·ªßa t√¥i | BabyCutie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<header class="header">
    <div class="container header-wrap">
        <div class="logo" onclick="location='index.html'"><img src="images/logo2.jpg"><span>BabyCutie</span></div>
        <button class="btn-login" onclick="location='index.html'">‚Üê Trang ch·ªß</button>
    </div>
</header>
<section class="container mt-4">
    <h2>üì¶ ƒê∆°n h√†ng c·ªßa t√¥i</h2>
    <div id="donHangList" class="mt-3"></div>
</section>
<script>
const token = localStorage.getItem("token");
if (!token) {
    alert("Vui l√≤ng ƒëƒÉng nh·∫≠p");
    window.location.href = "login-khach.html";
}

const userInfo = JSON.parse(localStorage.getItem("user_info") || '{}');
const nguoiDungId = userInfo.id;

if (!nguoiDungId) {
    alert("Kh√¥ng t√¨m th·∫•y th√¥ng tin ng∆∞·ªùi d√πng");
    window.location.href = "login-khach.html";
}

fetch(`http://127.0.0.1:5000/api/don-hang/nguoi-dung/${nguoiDungId}`)
    .then(r => r.json())
    .then(data => {
        const div = document.getElementById("donHangList");
        if (data.length === 0) {
            div.innerHTML = '<p class="text-center">B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>';
            return;
        }
        div.innerHTML = data.map(dh => `
            <div class="card mb-3">
                <div class="card-body">
                    <h5>ƒê∆°n h√†ng #${dh.id}</h5>
                    <p><strong>T·ªïng ti·ªÅn:</strong> ${new Intl.NumberFormat('vi-VN').format(dh.tongTien)}ƒë</p>
                    <p><strong>Tr·∫°ng th√°i:</strong> <span class="badge bg-info">${dh.trangThai}</span></p>
                    <p><strong>Ng√†y ƒë·∫∑t:</strong> ${new Date(dh.ngayDat).toLocaleDateString('vi-VN')}</p>
                    <p><strong>ƒê·ªãa ch·ªâ giao h√†ng:</strong> ${dh.diaChiGiaoHang || '-'}</p>
                    <button class="btn btn-sm btn-primary" onclick="xemChiTiet(${dh.id})">Xem chi ti·∫øt</button>
                </div>
            </div>
        `).join('');
    });

function xemChiTiet(id) {
    fetch(`http://127.0.0.1:5000/api/don-hang/${id}`)
        .then(r => r.json())
        .then(data => {
            let html = `ƒê∆°n h√†ng #${data.donHang.id}\n\n`;
            html += `T·ªïng ti·ªÅn: ${new Intl.NumberFormat('vi-VN').format(data.donHang.tongTien)}ƒë\n`;
            html += `Tr·∫°ng th√°i: ${data.donHang.trangThai}\n\nS·∫£n ph·∫©m:\n`;
            data.sanPham.forEach(sp => {
                html += `- ${sp.tenSanPham} x${sp.soLuong} - ${new Intl.NumberFormat('vi-VN').format(sp.gia)}ƒë\n`;
            });
            alert(html);
        });
}
</script>
</body>
</html>





