<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>BabyCutie ‚Äì Ch√°o dinh d∆∞·ª°ng cho b√©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/home.css">
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="header">
    <div class="container header-wrap">

        <!-- MOBILE MENU TOGGLE -->
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </button>

        <!-- LOGO -->
        <div class="logo" onclick="window.location='index.html'">
            <img src="images/logo2.jpg" alt="BabyCutie">
            <span>BabyCutie</span>
        </div>

        <!-- SEARCH -->
        <div class="search">
            <i class="fa fa-search"></i>
            <input type="text" id="searchInput" placeholder="T√¨m m√≥n ƒÉn cho b√©..." onkeyup="handleSearch(event)">
        </div>

        <!-- DESKTOP MENU -->
        <nav class="main-menu">
            <a href="index.html" class="active">Trang ch·ªß</a>
            <a href="thuc-don.html">Th·ª±c ƒë∆°n</a>
            <a href="khuyen-mai.html">Khuy·∫øn m√£i</a>
            <a href="tin-tuc.html">Tin t·ª©c</a>
            <a href="lien-he.html">Li√™n h·ªá</a>
        </nav>

        <!-- CART -->
        <div class="cart-icon" onclick="window.location='gio-hang.html'">
            <i class="fa-solid fa-cart-shopping"></i>
            <span class="cart-count" id="cartCount">0</span>
        </div>

        <!-- LOGIN / USER INFO -->
        <div class="login-group">
            <div id="userInfo" style="display: none;">
                <div class="dropdown">
                    <button class="btn-login dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fa fa-user"></i> <span id="userName"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="don-hang-cua-toi.html">üì¶ ƒê∆°n h√†ng c·ªßa t√¥i</a></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()">ƒêƒÉng xu·∫•t</a></li>
                    </ul>
                </div>
            </div>
            <div id="loginBtn">
            <div class="dropdown">
                <button class="btn-login dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fa fa-user"></i> <span class="d-none d-md-inline">ƒêƒÉng nh·∫≠p</span>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a class="dropdown-item" href="login-khach.html">
                            üë®‚Äçüë©‚Äçüëß Kh√°ch h√†ng
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="login-admin.html">
                            üõ† Admin
                        </a>
                    </li>
                </ul>
                </div>
            </div>
        </div>

    </div>
</header>

<!-- MOBILE MENU -->
<div class="mobile-menu" id="mobileMenu">
    <button class="mobile-menu-close" onclick="toggleMobileMenu()">
        <i class="fas fa-times"></i>
    </button>
    <nav>
        <a href="index.html" class="active" onclick="toggleMobileMenu()">üè† Trang ch·ªß</a>
        <a href="thuc-don.html" onclick="toggleMobileMenu()">üç≤ Th·ª±c ƒë∆°n</a>
        <a href="khuyen-mai.html" onclick="toggleMobileMenu()">üéâ Khuy·∫øn m√£i</a>
        <a href="tin-tuc.html" onclick="toggleMobileMenu()">üì∞ Tin t·ª©c</a>
        <a href="lien-he.html" onclick="toggleMobileMenu()">üìû Li√™n h·ªá</a>
        <a href="gio-hang.html" onclick="toggleMobileMenu()">üõí Gi·ªè h√†ng</a>
        <a href="login-khach.html" onclick="toggleMobileMenu()">üë§ ƒêƒÉng nh·∫≠p</a>
    </nav>
</div>

<!-- ================= HERO ================= -->
<section class="hero">
    <div class="container hero-wrap">

        <div class="hero-text">
            <h1>
                Dinh d∆∞·ª°ng tr·ªçn v·∫πn <br>
                cho b√© y√™u kh√¥n l·ªõn
            </h1>
            <p>
                Ch√°o dinh d∆∞·ª°ng BabyCutie ƒë∆∞·ª£c n·∫•u m·ªói ng√†y
                t·ª´ nguy√™n li·ªáu t∆∞∆°i s·∫°ch ‚Äì an to√†n ‚Äì khoa h·ªçc.
            </p>

            <div class="hero-btn">
                <button class="btn-primary" onclick="window.location='thuc-don.html'">
                    ƒê·∫∑t m√≥n ngay
                </button>
                <button class="btn-outline" onclick="window.location='thuc-don.html'">
                    Xem th·ª±c ƒë∆°n
                </button>
            </div>
        </div>

        <div class="hero-img">
            <img src="images/trem.jpg" alt="Ch√°o dinh d∆∞·ª°ng">
        </div>

    </div>
</section>

<!-- ================= BENEFIT ================= -->
<section class="benefit">
    <div class="container text-center">
        <h2>L·ª£i √≠ch khi ch·ªçn BabyCutie</h2>
        <p class="sub">Ch√∫ng t√¥i ƒë·∫∑t s·ª©c kh·ªèe c·ªßa b√© l√™n h√†ng ƒë·∫ßu</p>

        <div class="row mt-4">
            <div class="col-md-4">
                <div class="benefit-card">
                    üå±
                    <h5>Nguy√™n li·ªáu t∆∞∆°i s·∫°ch</h5>
                    <p>100% th·ª±c ph·∫©m r√µ ngu·ªìn g·ªëc</p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="benefit-card">
                    ‚ù§Ô∏è
                    <h5>C√¢n b·∫±ng dinh d∆∞·ª°ng</h5>
                    <p>Th·ª±c ƒë∆°n theo t·ª´ng ƒë·ªô tu·ªïi</p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="benefit-card">
                    üöö
                    <h5>Giao h√†ng nhanh</h5>
                    <p>Giao trong ng√†y ‚Äì gi·ªØ tr·ªçn ƒë·ªô n√≥ng</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================= FEATURED PRODUCT ================= -->
<section class="product">
    <div class="container">
        <div class="product-head">
            <h2>S·∫£n ph·∫©m n·ªïi b·∫≠t</h2>
            <a href="thuc-don.html">Xem t·∫•t c·∫£ ‚Üí</a>
        </div>

        <!-- JS s·∫Ω render s·∫£n ph·∫©m ·ªü ƒë√¢y -->
        <div class="row" id="sanPhamNoiBat">
            <!-- s·∫£n ph·∫©m t·ª´ API -->
        </div>
    </div>
</section>

<!-- ================= STATISTICS ================= -->
<section class="statistics">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-icon">üë∂</div>
                    <h3 class="stat-number" data-target="5000">0</h3>
                    <p>B√© y√™u ƒë√£ tin d√πng</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-icon">üç≤</div>
                    <h3 class="stat-number" data-target="50">0</h3>
                    <p>M√≥n ch√°o dinh d∆∞·ª°ng</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-icon">‚≠ê</div>
                    <h3 class="stat-number" data-target="98">0</h3>
                    <p>% Kh√°ch h√†ng h√†i l√≤ng</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-icon">üöö</div>
                    <h3 class="stat-number" data-target="24">0</h3>
                    <p>Gi·ªù giao h√†ng</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================= PROCESS ================= -->
<section class="process">
    <div class="container">
        <h2 class="text-center mb-5">Quy tr√¨nh ƒë·∫∑t h√†ng ƒë∆°n gi·∫£n</h2>
        <div class="row">
            <div class="col-md-3 col-6">
                <div class="process-item">
                    <div class="process-number">1</div>
                    <div class="process-icon">üõí</div>
                    <h5>Ch·ªçn m√≥n</h5>
                    <p>Xem th·ª±c ƒë∆°n v√† ch·ªçn m√≥n y√™u th√≠ch</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="process-item">
                    <div class="process-number">2</div>
                    <div class="process-icon">üìù</div>
                    <h5>ƒê·∫∑t h√†ng</h5>
                    <p>Th√™m v√†o gi·ªè v√† ƒëi·ªÅn th√¥ng tin</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="process-item">
                    <div class="process-number">3</div>
                    <div class="process-icon">üí≥</div>
                    <h5>Thanh to√°n</h5>
                    <p>Thanh to√°n COD ho·∫∑c chuy·ªÉn kho·∫£n</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="process-item">
                    <div class="process-number">4</div>
                    <div class="process-icon">üöö</div>
                    <h5>Nh·∫≠n h√†ng</h5>
                    <p>Giao h√†ng t·∫≠n n∆°i n√≥ng h·ªïi</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================= TESTIMONIALS ================= -->
<section class="testimonials">
    <div class="container">
        <h2 class="text-center mb-5">Kh√°ch h√†ng n√≥i g√¨ v·ªÅ ch√∫ng t√¥i</h2>
        <div class="row">
            <div class="col-md-4">
                <div class="testimonial-card">
                    <div class="testimonial-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="testimonial-text">"B√© nh√† m√¨nh r·∫•t th√≠ch ch√°o c√° h·ªìi b√≠ ƒë·ªè. M√≥n ƒÉn th∆°m ngon, ƒë·∫ßy ƒë·ªß dinh d∆∞·ª°ng. C·∫£m ∆°n BabyCutie!"</p>
                    <div class="testimonial-author">
                        <strong>Ch·ªã Lan</strong>
                        <span>M·∫π b√© Minh (8 th√°ng)</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="testimonial-card">
                    <div class="testimonial-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="testimonial-text">"Giao h√†ng nhanh, ch√°o c√≤n n√≥ng. B√© ƒÉn ngon mi·ªáng, tƒÉng c√¢n ƒë·ªÅu. R·∫•t h√†i l√≤ng v·ªõi d·ªãch v·ª•!"</p>
                    <div class="testimonial-author">
                        <strong>Ch·ªã H∆∞∆°ng</strong>
                        <span>M·∫π b√© An (1 tu·ªïi)</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="testimonial-card">
                    <div class="testimonial-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="testimonial-text">"Th·ª±c ƒë∆°n ƒëa d·∫°ng, gi√° c·∫£ h·ª£p l√Ω. ƒê·∫∑c bi·ªát l√† nguy√™n li·ªáu t∆∞∆°i s·∫°ch, an to√†n cho b√©."</p>
                    <div class="testimonial-author">
                        <strong>Anh Tu·∫•n</strong>
                        <span>B·ªë b√© Mai (10 th√°ng)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================= CTA SECTION ================= -->
<section class="cta-section">
    <div class="container">
        <div class="cta-box">
            <h2>ƒê·∫∑t h√†ng ngay h√¥m nay!</h2>
            <p>Nh·∫≠n ∆∞u ƒë√£i ƒë·∫∑c bi·ªát cho kh√°ch h√†ng m·ªõi</p>
            <div class="cta-buttons">
                <button class="btn-primary btn-lg" onclick="window.location='thuc-don.html'">
                    <i class="fa fa-shopping-cart"></i> Xem th·ª±c ƒë∆°n
                </button>
                <button class="btn-outline btn-lg" onclick="window.location='register-khach.html'">
                    <i class="fa fa-user-plus"></i> ƒêƒÉng k√Ω ngay
                </button>
            </div>
        </div>
</div>
</section>


<!-- ================= FOOTER ================= -->
<footer class="footer">
    <div class="container footer-wrap">
        <div>
            <b>BabyCutie</b>
            <p>Ch√°o dinh d∆∞·ª°ng cho b√© y√™u</p>
        </div>
        <div>
            <p><strong>Li√™n k·∫øt nhanh</strong></p>
            <p>
                <a href="thuc-don.html" style="color: #666; text-decoration: none; margin-right: 15px;">Th·ª±c ƒë∆°n</a>
                <a href="khuyen-mai.html" style="color: #666; text-decoration: none; margin-right: 15px;">Khuy·∫øn m√£i</a>
                <a href="tin-tuc.html" style="color: #666; text-decoration: none; margin-right: 15px;">Tin t·ª©c</a>
                <a href="lien-he.html" style="color: #666; text-decoration: none;">Li√™n h·ªá</a>
            </p>
        </div>
        <div>
            <p><strong>Th√¥ng tin</strong></p>
            <p>
                <a href="chinh-sach-bao-mat.html" style="color: #666; text-decoration: none;">Ch√≠nh s√°ch b·∫£o m·∫≠t</a>
            </p>
            <p>üìû Hotline: 1900 1234</p>
            <p>üìß babycutie@gmail.com</p>
        </div>
    </div>
</footer>

<!-- ================= TOAST NOTIFICATION ================= -->
<div id="toast" class="toast-notification"></div>

<!-- ================= CHATBOT WIDGET ================= -->
<div id="chatbotWidget" class="chatbot-widget">
    <!-- Chat Button -->
    <div id="chatbotButton" class="chatbot-button" onclick="toggleChatbot()">
        <i class="fas fa-comments"></i>
        <span class="chatbot-badge">1</span>
    </div>
    
    <!-- Chat Window -->
    <div id="chatbotWindow" class="chatbot-window">
        <div class="chatbot-header">
            <div class="chatbot-header-info">
                <div class="chatbot-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <h5>BabyCutie Bot</h5>
                    <span class="chatbot-status">ƒêang tr·ª±c tuy·∫øn</span>
                </div>
            </div>
            <button class="chatbot-close" onclick="toggleChatbot()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="chatbot-message bot-message">
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <p>Xin ch√†o! üëã T√¥i l√† BabyCutie Bot, t√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</p>
                </div>
            </div>
            
            <!-- Quick Questions -->
            <div class="quick-questions">
                <p class="quick-questions-title">C√¢u h·ªèi th∆∞·ªùng g·∫∑p:</p>
                <button class="quick-question-btn" onclick="sendQuickQuestion('Gi√° s·∫£n ph·∫©m nh∆∞ th·∫ø n√†o?')">
                    üí∞ Gi√° s·∫£n ph·∫©m
                </button>
                <button class="quick-question-btn" onclick="sendQuickQuestion('C√°ch ƒë·∫∑t h√†ng?')">
                    üõí C√°ch ƒë·∫∑t h√†ng
                </button>
                <button class="quick-question-btn" onclick="sendQuickQuestion('Th·ªùi gian giao h√†ng?')">
                    üöö Th·ªùi gian giao h√†ng
                </button>
                <button class="quick-question-btn" onclick="sendQuickQuestion('Ph∆∞∆°ng th·ª©c thanh to√°n?')">
                    üí≥ Thanh to√°n
                </button>
            </div>
        </div>
        
        <div class="chatbot-input-area">
            <input 
                type="text" 
                id="chatbotInput" 
                class="chatbot-input" 
                placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..."
                onkeypress="handleChatbotKeyPress(event)"
            >
            <button class="chatbot-send-btn" onclick="sendChatbotMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</div>

<!-- ================= JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const API_URL = "http://127.0.0.1:5000/api/thuc-don";
const sanPhamNoiBat = document.getElementById("sanPhamNoiBat");

// Toast notification function
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = `toast-notification ${type} show`;
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Ki·ªÉm tra ƒëƒÉng nh·∫≠p v√† hi·ªÉn th·ªã th√¥ng tin
const token = localStorage.getItem("token");
const userInfo = JSON.parse(localStorage.getItem("user_info") || '{}');

if (token && userInfo.hoTen) {
    document.getElementById("userInfo").style.display = "block";
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("userName").textContent = userInfo.hoTen;
} else {
    document.getElementById("userInfo").style.display = "none";
    document.getElementById("loginBtn").style.display = "block";
}

function logout() {
    localStorage.removeItem("token");
    localStorage.removeItem("user_info");
    showToast("ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng", "info");
    setTimeout(() => {
        location.reload();
    }, 1000);
}

// Load s·∫£n ph·∫©m n·ªïi b·∫≠t v·ªõi loading state
function loadSanPhamNoiBat() {
    // Hi·ªÉn th·ªã loading
    sanPhamNoiBat.innerHTML = `
        <div class="col-12 text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">ƒêang t·∫£i s·∫£n ph·∫©m...</p>
        </div>
    `;

fetch(API_URL)
        .then(res => {
            if (!res.ok) throw new Error('Network response was not ok');
            return res.json();
        })
    .then(data => {
        // L·∫•y t·ªëi ƒëa 6 s·∫£n ph·∫©m ƒë·∫ßu
        const dsNoiBat = data.slice(0, 6);
        let html = "";

            if (dsNoiBat.length === 0) {
                html = `
                    <div class="col-12 text-center py-5">
                        <p class="text-muted">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</p>
                    </div>
                `;
            } else {
        dsNoiBat.forEach(sp => {
            html += `
                <div class="col-md-4 mb-4">
                            <div class="product-card" onclick="viewProductDetail(${sp.id})" style="cursor: pointer;">
                                <div class="product-image-wrapper">
                                    <img 
                                        src="http://127.0.0.1:5000/images/${sp.hinhAnh || 'default.jpg'}" 
                                        alt="${sp.tenSanPham}"
                                        onerror="this.src='images/default.jpg'"
                                    >
                                    <div class="product-overlay">
                                        <button class="btn-quick-view" onclick="event.stopPropagation(); viewProductDetail(${sp.id})">
                                            <i class="fa fa-eye"></i> Xem chi ti·∫øt
                                        </button>
                                    </div>
                                </div>
                                <div class="product-info">
                                    <h5>${sp.tenSanPham}</h5>
                                    <p class="price">${Number(sp.gia).toLocaleString('vi-VN')}ƒë</p>
                                    
                                    ${sp.moTa ? `<p class="desc">${sp.moTa.substring(0, 60)}${sp.moTa.length > 60 ? '...' : ''}</p>` : ''}

                        <div class="nutrition">
                                        <span>üí™ <b>${sp.protein || 0}g</b></span>
                                        <span>üçö <b>${sp.carb || 0}g</b></span>
                                        <span>ü•ë <b>${sp.chatBeo || 0}g</b></span>
                        </div>

                                    ${sp.doTuoi ? `<small class="age">üë∂ ${sp.doTuoi}</small>` : ''}
                                    
                                    <button class="btn-add-cart" onclick="event.stopPropagation(); addToCart(${sp.id})">
                                        <i class="fa fa-cart-plus"></i> Th√™m v√†o gi·ªè
                        </button>
                                </div>
                    </div>
                </div>
            `;
        });
            }

        sanPhamNoiBat.innerHTML = html;
    })
    .catch(err => {
        console.error("L·ªói load s·∫£n ph·∫©m:", err);
            sanPhamNoiBat.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fa fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                    <p class="mt-3 text-muted">Kh√¥ng th·ªÉ t·∫£i s·∫£n ph·∫©m. Vui l√≤ng th·ª≠ l·∫°i sau.</p>
                    <button class="btn btn-primary mt-2" onclick="loadSanPhamNoiBat()">
                        <i class="fa fa-refresh"></i> Th·ª≠ l·∫°i
                    </button>
                </div>
            `;
        });
}

// Xem chi ti·∫øt s·∫£n ph·∫©m
function viewProductDetail(id) {
    window.location.href = `chi-tiet-san-pham.html?id=${id}`;
}

// Th√™m v√†o gi·ªè h√†ng v·ªõi loading state
function addToCart(id) {
    if (!token) {
        showToast("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m v√†o gi·ªè h√†ng", "warning");
        setTimeout(() => {
            window.location.href = "login-khach.html";
        }, 1500);
        return;
    }

    // Disable button v√† hi·ªÉn th·ªã loading
    const buttons = document.querySelectorAll(`button[onclick*="addToCart(${id})"]`);
    buttons.forEach(btn => {
        btn.disabled = true;
        btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> ƒêang th√™m...';
    });

    fetch("http://127.0.0.1:5000/api/gio-hang", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify({
            sanPham_id: id,
            soLuong: 1
        })
    })
    .then(res => res.json())
    .then(data => {
        // Re-enable buttons
        buttons.forEach(btn => {
            btn.disabled = false;
            btn.innerHTML = '<i class="fa fa-cart-plus"></i> Th√™m v√†o gi·ªè';
        });

        if (data.success) {
            showToast("‚úÖ ƒê√£ th√™m v√†o gi·ªè h√†ng!", "success");
            updateCartCount();
            // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng tr√™n n√∫t
            updateProductButtonQuantity(id);
            // Animation cho cart icon
            const cartIcon = document.querySelector('.cart-icon');
            cartIcon.classList.add('bounce');
            setTimeout(() => cartIcon.classList.remove('bounce'), 500);
        } else {
            showToast("L·ªói: " + (data.message || "Kh√¥ng th·ªÉ th√™m v√†o gi·ªè"), "error");
        }
    })
    .catch(err => {
        buttons.forEach(btn => {
            btn.disabled = false;
            btn.innerHTML = '<i class="fa fa-cart-plus"></i> Th√™m v√†o gi·ªè';
        });
        showToast("L·ªói k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i.", "error");
        console.error("Error:", err);
    });
}

// C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng gi·ªè h√†ng
function updateCartCount() {
    if (!token) {
        const cartCountEl = document.getElementById("cartCount");
        if (cartCountEl) cartCountEl.textContent = "0";
        return;
    }
    
    fetch("http://127.0.0.1:5000/api/gio-hang", {
        headers: {"Authorization": "Bearer " + token}
    })
    .then(res => {
        if (!res.ok) throw new Error('Failed to fetch cart');
        return res.json();
    })
    .then(data => {
        const total = data.reduce((sum, item) => sum + item.soLuong, 0);
        const cartCountEl = document.getElementById("cartCount");
        if (cartCountEl) {
            cartCountEl.textContent = total;
            
            // Hi·ªÉn th·ªã/·∫©n badge
            if (total > 0) {
                cartCountEl.style.display = "flex";
                // Animation
                cartCountEl.classList.add("bounce");
                setTimeout(() => cartCountEl.classList.remove("bounce"), 500);
            } else {
                cartCountEl.style.display = "none";
            }
        }
    })
    .catch(() => {
        const cartCountEl = document.getElementById("cartCount");
        if (cartCountEl) cartCountEl.textContent = "0";
    });
}

// C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng tr√™n n√∫t s·∫£n ph·∫©m
function updateProductButtonQuantity(sanPhamId) {
    if (!token) return;

    fetch("http://127.0.0.1:5000/api/gio-hang", {
        headers: {"Authorization": "Bearer " + token}
    })
    .then(res => res.json())
    .then(cartItems => {
        const item = cartItems.find(i => i.sanPham_id === sanPhamId);
        const buttons = document.querySelectorAll(`button[onclick*="addToCart(${sanPhamId})"]`);
        
        buttons.forEach(btn => {
            if (item && item.soLuong > 0) {
                btn.innerHTML = `<i class="fa fa-cart-plus"></i> ƒê√£ th√™m (${item.soLuong})`;
                btn.style.background = "linear-gradient(135deg, #28a745, #20c997)";
                btn.style.color = "#fff";
            } else {
                btn.innerHTML = '<i class="fa fa-cart-plus"></i> Th√™m v√†o gi·ªè';
                btn.style.background = "";
                btn.style.color = "";
            }
        });
    })
    .catch(err => console.error("Error updating button:", err));
}

// C·∫≠p nh·∫≠t t·∫•t c·∫£ n√∫t s·∫£n ph·∫©m khi load
function updateAllProductButtons() {
    if (!token) return;

    fetch("http://127.0.0.1:5000/api/gio-hang", {
        headers: {"Authorization": "Bearer " + token}
    })
    .then(res => res.json())
    .then(cartItems => {
        cartItems.forEach(item => {
            updateProductButtonQuantity(item.sanPham_id);
        });
    })
    .catch(err => console.error("Error:", err));
}

// Search functionality - Enter key v√† click icon
function handleSearch(event) {
    if (event.key === 'Enter' || event.type === 'click') {
        const searchInput = document.getElementById('searchInput');
        const keyword = searchInput.value.trim();
        if (keyword) {
            window.location.href = `thuc-don.html?search=${encodeURIComponent(keyword)}`;
        } else {
            showToast("Vui l√≤ng nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm", "warning");
        }
    }
}

// Mobile Menu Toggle
function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobileMenu');
    if (mobileMenu) {
        mobileMenu.classList.toggle('active');
        // Prevent body scroll when menu is open
        if (mobileMenu.classList.contains('active')) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = '';
        }
    }
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
    const mobileMenu = document.getElementById('mobileMenu');
    const menuToggle = document.querySelector('.mobile-menu-toggle');
    
    if (mobileMenu && !mobileMenu.contains(event.target) && 
        menuToggle && !menuToggle.contains(event.target) &&
        mobileMenu.classList.contains('active')) {
        toggleMobileMenu();
    }
});

// Th√™m event listener cho search icon
document.addEventListener('DOMContentLoaded', () => {
    const searchIcon = document.querySelector('.search i.fa-search');
    if (searchIcon) {
        searchIcon.addEventListener('click', handleSearch);
        searchIcon.style.cursor = 'pointer';
    }
    
    // Load s·∫£n ph·∫©m
    loadSanPhamNoiBat();
    
    // Update cart count n·∫øu ƒë√£ ƒëƒÉng nh·∫≠p
    if (token) {
        updateCartCount();
    }
    
    // Initialize animations
    animateStats();
    animateOnScroll();
});

// Animate statistics v·ªõi c·∫£i thi·ªán
function animateStats() {
    const stats = document.querySelectorAll('.stat-number');
    if (stats.length === 0) return;
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && !entry.target.classList.contains('animated')) {
                entry.target.classList.add('animated');
                const target = parseInt(entry.target.getAttribute('data-target'));
                const isPercent = entry.target.getAttribute('data-target') === '98';
                const duration = 2000;
                const increment = target / (duration / 16);
                let current = 0;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        entry.target.textContent = target + (isPercent ? '%' : '+');
                        clearInterval(timer);
                    } else {
                        entry.target.textContent = Math.floor(current) + (isPercent ? '%' : '+');
                    }
                }, 16);
                
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.5 });
    
    stats.forEach(stat => observer.observe(stat));
}

// Animate elements on scroll
function animateOnScroll() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in-up');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });
    
    // Observe c√°c sections
    document.querySelectorAll('.benefit-card, .process-item, .testimonial-card, .product-card').forEach(el => {
        observer.observe(el);
    });
}

// Smooth scroll cho c√°c anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Lazy load images
if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                }
                observer.unobserve(img);
            }
        });
    });
    
    document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
    });
}

// ================= CHATBOT FUNCTIONALITY =================
let chatbotOpen = false;

// Toggle chatbot window
function toggleChatbot() {
    const chatbotWindow = document.getElementById('chatbotWindow');
    const chatbotButton = document.getElementById('chatbotButton');
    const chatbotBadge = document.querySelector('.chatbot-badge');
    
    chatbotOpen = !chatbotOpen;
    
    if (chatbotOpen) {
        chatbotWindow.classList.add('active');
        chatbotBadge.style.display = 'none';
        // Focus input
        setTimeout(() => {
            document.getElementById('chatbotInput').focus();
        }, 300);
    } else {
        chatbotWindow.classList.remove('active');
    }
}

// Send message from quick question button
function sendQuickQuestion(question) {
    document.getElementById('chatbotInput').value = question;
    sendChatbotMessage();
}

// Handle Enter key press
function handleChatbotKeyPress(event) {
    if (event.key === 'Enter') {
        sendChatbotMessage();
    }
}

// Send chatbot message
function sendChatbotMessage() {
    const input = document.getElementById('chatbotInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Add user message
    addChatbotMessage(message, 'user');
    input.value = '';
    
    // Show typing indicator
    showTypingIndicator();
    
    // Get bot response after delay
    setTimeout(async () => {
        hideTypingIndicator();
        const botResponse = await getBotResponse(message);
        addChatbotMessage(botResponse, 'bot');
    }, 1000);
}

// Add message to chat
function addChatbotMessage(message, type) {
    const messagesContainer = document.getElementById('chatbotMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `chatbot-message ${type}-message`;
    
    const avatarIcon = type === 'bot' ? 'fa-robot' : 'fa-user';
    
    // Convert newlines to <br> and preserve emojis
    const formattedMessage = message.replace(/\n/g, '<br>');
    
    messageDiv.innerHTML = `
        <div class="message-avatar">
            <i class="fas ${avatarIcon}"></i>
        </div>
        <div class="message-content">
            <p>${formattedMessage}</p>
        </div>
    `;
    
    messagesContainer.appendChild(messageDiv);
    
    // Smooth scroll to bottom
    setTimeout(() => {
        messagesContainer.scrollTo({
            top: messagesContainer.scrollHeight,
            behavior: 'smooth'
        });
    }, 100);
}

// Show typing indicator
function showTypingIndicator() {
    const messagesContainer = document.getElementById('chatbotMessages');
    const typingDiv = document.createElement('div');
    typingDiv.id = 'typingIndicator';
    typingDiv.className = 'chatbot-message bot-message';
    typingDiv.innerHTML = `
        <div class="message-avatar">
            <i class="fas fa-robot"></i>
        </div>
        <div class="message-content">
            <p>
                <i class="fas fa-circle" style="font-size: 8px; color: #ff6b81;"></i>
                <i class="fas fa-circle" style="font-size: 8px; color: #ff6b81;"></i>
                <i class="fas fa-circle" style="font-size: 8px; color: #ff6b81;"></i>
            </p>
        </div>
    `;
    messagesContainer.appendChild(typingDiv);
    setTimeout(() => {
        messagesContainer.scrollTo({
            top: messagesContainer.scrollHeight,
            behavior: 'smooth'
        });
    }, 100);
}

// Hide typing indicator
function hideTypingIndicator() {
    const typingIndicator = document.getElementById('typingIndicator');
    if (typingIndicator) {
        typingIndicator.remove();
    }
}

// Chatbot data cache
let chatbotData = {
    sanPham: [],
    khuyenMai: [],
    tinTuc: [],
    danhMuc: []
};

// Load data for chatbot
async function loadChatbotData() {
    try {
        // Load s·∫£n ph·∫©m
        const spRes = await fetch('http://127.0.0.1:5000/api/thuc-don/');
        if (spRes.ok) {
            chatbotData.sanPham = await spRes.json();
        }
        
        // Load khuy·∫øn m√£i
        const kmRes = await fetch('http://127.0.0.1:5000/api/khuyen-mai/?only_active=true');
        if (kmRes.ok) {
            chatbotData.khuyenMai = await kmRes.json();
        }
        
        // Load tin t·ª©c
        const ttRes = await fetch('http://127.0.0.1:5000/api/tin-tuc/');
        if (ttRes.ok) {
            chatbotData.tinTuc = await ttRes.json();
        }
        
        // Load danh m·ª•c
        const dmRes = await fetch('http://127.0.0.1:5000/api/thuc-don/danh-muc');
        if (dmRes.ok) {
            chatbotData.danhMuc = await dmRes.json();
        }
    } catch (error) {
        console.error('L·ªói load d·ªØ li·ªáu cho chatbot:', error);
    }
}

// Load data when page loads
loadChatbotData();

// T√¨m ki·∫øm s·∫£n ph·∫©m th√¥ng minh
function searchProducts(query) {
    if (!chatbotData.sanPham || chatbotData.sanPham.length === 0) return [];
    
    const lowerQuery = query.toLowerCase().trim();
    const keywords = lowerQuery.split(/\s+/).filter(k => k.length > 1);
    
    // T·ª´ kh√≥a s·∫£n ph·∫©m ph·ªï bi·∫øn
    const productKeywords = {
        'c√° h·ªìi': ['c√° h·ªìi', 'cahoibido', 'c√° h·ªìi b√≠ ƒë·ªè'],
        'g√†': ['g√†', 'gacarot', 'g√† c√† r·ªët', 'g√† √°c'],
        'b√≤': ['b√≤', 'thitboraungot', 'b√≤ rau ng√≥t'],
        't√¥m': ['t√¥m', 'tomhatsen', 't√¥m h·∫°t sen'],
        'c√° l√≥c': ['c√° l√≥c', 'calocmongtoi', 'c√° l√≥c m·ªìng t∆°i'],
        'heo': ['heo', 'th·ªãt heo', 'heobixanh', 'heo b√≠ xanh'],
        'l∆∞∆°n': ['l∆∞∆°n', 'luonkhoaimon', 'l∆∞∆°n khoai m√¥n'],
        's∆∞·ªùn': ['s∆∞·ªùn', 'suonnoncarot', 's∆∞·ªùn non'],
        'c√° thu': ['c√° thu', 'cathuraucu', 'c√° thu rau c·ªß']
    };
    
    // T√¨m s·∫£n ph·∫©m kh·ªõp
    const found = chatbotData.sanPham.filter(sp => {
        const tenSP = (sp.tenSanPham || '').toLowerCase();
        const moTa = (sp.moTa || '').toLowerCase();
        
        // Ki·ªÉm tra t·ª´ kh√≥a tr·ª±c ti·∫øp
        if (tenSP.includes(lowerQuery) || lowerQuery.includes(tenSP.split(' ')[0])) {
            return true;
        }
        
        // Ki·ªÉm tra theo t·ª´ kh√≥a s·∫£n ph·∫©m
        for (const [key, variants] of Object.entries(productKeywords)) {
            if (lowerQuery.includes(key) || variants.some(v => lowerQuery.includes(v))) {
                if (tenSP.includes(key) || variants.some(v => tenSP.includes(v))) {
                    return true;
                }
            }
        }
        
        // Ki·ªÉm tra t·ª´ng t·ª´ kh√≥a
        return keywords.some(kw => tenSP.includes(kw) || moTa.includes(kw));
    });
    
    return found;
}

// Get bot response based on user message
async function getBotResponse(message) {
    const lowerMessage = message.toLowerCase().trim();
    
    // Li·ªát k√™ t·∫•t c·∫£ s·∫£n ph·∫©m
    if (lowerMessage.includes('c√≥ nh·ªØng m√≥n') || lowerMessage.includes('danh s√°ch') || 
        lowerMessage.includes('s·∫£n ph·∫©m n√†o') || lowerMessage.includes('m√≥n n√†o') ||
        (lowerMessage.includes('c√≥') && lowerMessage.includes('m√≥n'))) {
        if (chatbotData.sanPham.length > 0) {
            let response = `üç≤ Ch√∫ng t√¥i c√≥ ${chatbotData.sanPham.length} m√≥n ch√°o dinh d∆∞·ª°ng:\n\n`;
            chatbotData.sanPham.slice(0, 8).forEach((sp, idx) => {
                const gia = sp.giaVua || sp.gia;
                response += `${idx + 1}. ${sp.tenSanPham} - ${parseInt(gia).toLocaleString('vi-VN')}ƒë\n`;
            });
            if (chatbotData.sanPham.length > 8) {
                response += `\n... v√† ${chatbotData.sanPham.length - 8} m√≥n kh√°c!\n`;
            }
            response += '\nB·∫°n c√≥ th·ªÉ xem chi ti·∫øt t·∫°i trang Th·ª±c ƒë∆°n!';
            return response;
        }
        return 'üç≤ Ch√∫ng t√¥i c√≥ nhi·ªÅu m√≥n ch√°o dinh d∆∞·ª°ng cho b√©. B·∫°n c√≥ th·ªÉ xem t·∫°i trang Th·ª±c ƒë∆°n!';
    }
    
    // T√¨m ki·∫øm s·∫£n ph·∫©m c·ª• th·ªÉ
    const productSearch = searchProducts(lowerMessage);
    if (productSearch.length > 0) {
        const product = productSearch[0];
        const giaVua = product.giaVua ? parseInt(product.giaVua) : parseInt(product.gia);
        const giaLon = product.giaLon ? parseInt(product.giaLon) : null;
        const giaDai = product.giaDai ? parseInt(product.giaDai) : null;
        
        let priceInfo = `üí∞ Gi√°: ${giaVua.toLocaleString('vi-VN')}ƒë`;
        if (giaLon && giaDai) {
            priceInfo += ` (V·ª´a) / ${giaLon.toLocaleString('vi-VN')}ƒë (L·ªõn) / ${giaDai.toLocaleString('vi-VN')}ƒë (ƒê·∫°i)`;
        } else if (giaLon) {
            priceInfo += ` (V·ª´a) / ${giaLon.toLocaleString('vi-VN')}ƒë (L·ªõn)`;
        }
        
        let nutritionInfo = '';
        if (product.protein || product.carb || product.chatBeo) {
            nutritionInfo = `\nüå± Dinh d∆∞·ª°ng:\n   - Protein: ${product.protein || 'N/A'}g\n   - Carb: ${product.carb || 'N/A'}g\n   - Ch·∫•t b√©o: ${product.chatBeo || 'N/A'}g`;
        }
        
        return `üç≤ ${product.tenSanPham}\n${priceInfo}\nüìù ${product.moTa || 'S·∫£n ph·∫©m dinh d∆∞·ª°ng cho b√©'}\nüë∂ ƒê·ªô tu·ªïi: ${product.doTuoi || 'N/A'}${nutritionInfo}\n\nB·∫°n c√≥ th·ªÉ xem chi ti·∫øt v√† ƒë·∫∑t h√†ng t·∫°i trang Th·ª±c ƒë∆°n!`;
    }
    
    // Keywords matching
    if (lowerMessage.includes('gi√°') || lowerMessage.includes('price') || lowerMessage.includes('cost') || 
        lowerMessage.includes('bao nhi√™u ti·ªÅn') || lowerMessage.includes('gi√° c·∫£')) {
        if (chatbotData.sanPham.length > 0) {
            const prices = chatbotData.sanPham.map(sp => {
                const gia = sp.giaVua || sp.gia;
                return gia ? parseInt(gia) : null;
            }).filter(p => p !== null);
            
            if (prices.length > 0) {
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                return `üí∞ Gi√° s·∫£n ph·∫©m c·ªßa ch√∫ng t√¥i dao ƒë·ªông t·ª´ ${minPrice.toLocaleString('vi-VN')}ƒë - ${maxPrice.toLocaleString('vi-VN')}ƒë t√πy theo lo·∫°i v√† size.\n\nCh√∫ng t√¥i c√≥ ${chatbotData.sanPham.length} m√≥n ch√°o dinh d∆∞·ª°ng. M·ªói m√≥n c√≥ 3 size: V·ª´a, L·ªõn, ƒê·∫°i v·ªõi gi√° kh√°c nhau.\n\nB·∫°n c√≥ th·ªÉ xem chi ti·∫øt gi√° t·∫°i trang Th·ª±c ƒë∆°n!`;
            }
        }
        return 'üí∞ Gi√° s·∫£n ph·∫©m c·ªßa ch√∫ng t√¥i dao ƒë·ªông t·ª´ 25.000ƒë - 80.000ƒë t√πy theo lo·∫°i ch√°o v√† size. B·∫°n c√≥ th·ªÉ xem chi ti·∫øt gi√° t·∫°i trang Th·ª±c ƒë∆°n. Ch√∫ng t√¥i th∆∞·ªùng xuy√™n c√≥ c√°c ch∆∞∆°ng tr√¨nh khuy·∫øn m√£i h·∫•p d·∫´n!';
    }
    
    if (lowerMessage.includes('ƒë·∫∑t h√†ng') || lowerMessage.includes('order') || lowerMessage.includes('mua') ||
        lowerMessage.includes('mua h√†ng') || lowerMessage.includes('c√°ch ƒë·∫∑t')) {
        return 'üõí ƒê·ªÉ ƒë·∫∑t h√†ng, b·∫°n c√≥ th·ªÉ:\n\n1Ô∏è‚É£ Ch·ªçn m√≥n t·∫°i trang Th·ª±c ƒë∆°n\n2Ô∏è‚É£ Ch·ªçn size (V·ª´a/L·ªõn/ƒê·∫°i) v√† s·ªë l∆∞·ª£ng\n3Ô∏è‚É£ Th√™m v√†o gi·ªè h√†ng\n4Ô∏è‚É£ Ki·ªÉm tra gi·ªè h√†ng v√† ƒëi·ªÅn th√¥ng tin giao h√†ng\n5Ô∏è‚É£ Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n\n6Ô∏è‚É£ X√°c nh·∫≠n ƒë∆°n h√†ng\n\nCh√∫ng t√¥i s·∫Ω giao h√†ng t·∫≠n n∆°i cho b·∫°n trong ng√†y! üöö';
    }
    
    if (lowerMessage.includes('giao h√†ng') || lowerMessage.includes('delivery') || lowerMessage.includes('ship') ||
        lowerMessage.includes('th·ªùi gian giao') || lowerMessage.includes('bao l√¢u')) {
        return 'üöö Th√¥ng tin giao h√†ng:\n\n‚è∞ Th·ªùi gian: Giao h√†ng trong ng√†y, t·ª´ 30 ph√∫t - 2 gi·ªù t√πy ƒë·ªãa ch·ªâ\nüí∞ Ph√≠ giao h√†ng: 15.000ƒë - 30.000ƒë t√πy khu v·ª±c\nüå°Ô∏è ƒê·∫£m b·∫£o: Ch√°o c√≤n n√≥ng h·ªïi khi ƒë·∫øn tay b·∫°n\nüìç Khu v·ª±c: Giao h√†ng to√†n th√†nh ph·ªë\n\nB·∫°n c√≥ th·ªÉ theo d√µi ƒë∆°n h√†ng sau khi ƒë·∫∑t!';
    }
    
    if (lowerMessage.includes('thanh to√°n') || lowerMessage.includes('payment') || lowerMessage.includes('pay')) {
        return 'üí≥ Ch√∫ng t√¥i h·ªó tr·ª£ 2 ph∆∞∆°ng th·ª©c thanh to√°n:\n1. üíµ Thanh to√°n khi nh·∫≠n h√†ng (COD)\n2. üè¶ Chuy·ªÉn kho·∫£n ng√¢n h√†ng (c√≥ th·ªÉ upload phi·∫øu thu)\n\nB·∫°n c√≥ th·ªÉ ch·ªçn ph∆∞∆°ng th·ª©c ph√π h·ª£p khi ƒë·∫∑t h√†ng!';
    }
    
    if (lowerMessage.includes('dinh d∆∞·ª°ng') || lowerMessage.includes('nutrition') || lowerMessage.includes('th√†nh ph·∫ßn') ||
        lowerMessage.includes('ch·∫•t dinh d∆∞·ª°ng')) {
        if (chatbotData.sanPham.length > 0) {
            // T√¨m s·∫£n ph·∫©m c√≥ ƒë·∫ßy ƒë·ªß th√¥ng tin dinh d∆∞·ª°ng
            const sample = chatbotData.sanPham.find(sp => sp.protein && sp.carb && sp.chatBeo) || chatbotData.sanPham[0];
            return `üå± S·∫£n ph·∫©m c·ªßa ch√∫ng t√¥i ƒë∆∞·ª£c n·∫•u t·ª´ nguy√™n li·ªáu t∆∞∆°i s·∫°ch, ƒë·∫£m b·∫£o ƒë·∫ßy ƒë·ªß dinh d∆∞·ª°ng cho b√©.\n\nüìä V√≠ d·ª•: ${sample.tenSanPham}\n   - Protein: ${sample.protein || 'N/A'}g\n   - Carb: ${sample.carb || 'N/A'}g\n   - Ch·∫•t b√©o: ${sample.chatBeo || 'N/A'}g\n\nM·ªói m√≥n ch√°o ƒë·ªÅu c√≥ th√¥ng tin chi ti·∫øt v·ªÅ dinh d∆∞·ª°ng. B·∫°n c√≥ th·ªÉ xem t·∫°i trang s·∫£n ph·∫©m!`;
        }
        return 'üå± S·∫£n ph·∫©m c·ªßa ch√∫ng t√¥i ƒë∆∞·ª£c n·∫•u t·ª´ nguy√™n li·ªáu t∆∞∆°i s·∫°ch, ƒë·∫£m b·∫£o ƒë·∫ßy ƒë·ªß dinh d∆∞·ª°ng cho b√©. M·ªói m√≥n ch√°o ƒë·ªÅu c√≥ th√¥ng tin chi ti·∫øt v·ªÅ protein, carb v√† ch·∫•t b√©o. B·∫°n c√≥ th·ªÉ xem t·∫°i trang s·∫£n ph·∫©m!';
    }
    
    if (lowerMessage.includes('ƒë·ªô tu·ªïi') || lowerMessage.includes('age') || lowerMessage.includes('tu·ªïi')) {
        if (chatbotData.sanPham.length > 0) {
            const doTuoiList = [...new Set(chatbotData.sanPham.map(sp => sp.doTuoi).filter(d => d))];
            return `üë∂ Ch√∫ng t√¥i c√≥ th·ª±c ƒë∆°n ph√π h·ª£p cho c√°c ƒë·ªô tu·ªïi:\n${doTuoiList.map(dt => `- ${dt}`).join('\n')}\n\nB·∫°n c√≥ th·ªÉ ch·ªçn m√≥n ph√π h·ª£p v·ªõi ƒë·ªô tu·ªïi c·ªßa b√© t·∫°i trang Th·ª±c ƒë∆°n!`;
        }
        return 'üë∂ Ch√∫ng t√¥i c√≥ th·ª±c ƒë∆°n ph√π h·ª£p cho c√°c ƒë·ªô tu·ªïi:\n- 6-12 th√°ng: Ch√°o xay nhuy·ªÖn\n- 1-3 tu·ªïi: Ch√°o ƒë·∫ßy ƒë·ªß dinh d∆∞·ª°ng\n\nB·∫°n c√≥ th·ªÉ ch·ªçn m√≥n ph√π h·ª£p v·ªõi ƒë·ªô tu·ªïi c·ªßa b√©!';
    }
    
    if (lowerMessage.includes('li√™n h·ªá') || lowerMessage.includes('contact') || lowerMessage.includes('hotline')) {
        return 'üìû B·∫°n c√≥ th·ªÉ li√™n h·ªá v·ªõi ch√∫ng t√¥i qua:\n- Hotline: 1900 1234\n- Email: babycutie@gmail.com\n- Ho·∫∑c truy c·∫≠p trang Li√™n h·ªá ƒë·ªÉ g·ª≠i tin nh·∫Øn tr·ª±c ti·∫øp!';
    }
    
    if (lowerMessage.includes('khuy·∫øn m√£i') || lowerMessage.includes('promotion') || lowerMessage.includes('sale') || 
        lowerMessage.includes('gi·∫£m gi√°') || lowerMessage.includes('m√£ gi·∫£m') || lowerMessage.includes('m√£ khuy·∫øn m√£i') ||
        lowerMessage.includes('voucher') || lowerMessage.includes('∆∞u ƒë√£i')) {
        if (chatbotData.khuyenMai.length > 0) {
            const activePromos = chatbotData.khuyenMai.slice(0, 5);
            let response = `üéâ Ch√∫ng t√¥i ƒëang c√≥ ${chatbotData.khuyenMai.length} ch∆∞∆°ng tr√¨nh khuy·∫øn m√£i:\n\n`;
            activePromos.forEach((km, idx) => {
                const loai = km.loaiGiamGia === 'phan_tram' ? `${km.giaTriGiam}%` : `${parseInt(km.giaTriGiam).toLocaleString('vi-VN')}ƒë`;
                const minOrder = km.donHangToiThieu ? `\n   üìã ƒê∆°n t·ªëi thi·ªÉu: ${parseInt(km.donHangToiThieu).toLocaleString('vi-VN')}ƒë` : '';
                const maxDiscount = km.giaTriToiDa ? `\n   ‚¨ÜÔ∏è Gi·∫£m t·ªëi ƒëa: ${parseInt(km.giaTriToiDa).toLocaleString('vi-VN')}ƒë` : '';
                response += `${idx + 1}. üéÅ ${km.tenKhuyenMai}\n   üîë M√£: **${km.maKhuyenMai}**\n   üí∞ Gi·∫£m: ${loai}${minOrder}${maxDiscount}\n\n`;
            });
            response += 'üí° B·∫°n c√≥ th·ªÉ xem t·∫•t c·∫£ m√£ khuy·∫øn m√£i v√† copy m√£ t·∫°i trang Khuy·∫øn m√£i!';
            return response;
        }
        return 'üéâ Ch√∫ng t√¥i th∆∞·ªùng xuy√™n c√≥ c√°c ch∆∞∆°ng tr√¨nh khuy·∫øn m√£i h·∫•p d·∫´n! H√£y theo d√µi trang web ho·∫∑c fanpage ƒë·ªÉ kh√¥ng b·ªè l·ª° c√°c ∆∞u ƒë√£i ƒë·∫∑c bi·ªát. Kh√°ch h√†ng m·ªõi s·∫Ω nh·∫≠n ƒë∆∞·ª£c ∆∞u ƒë√£i ƒë·∫∑c bi·ªát!\n\nB·∫°n c√≥ th·ªÉ xem t·∫°i trang Khuy·∫øn m√£i!';
    }
    
    if (lowerMessage.includes('tin t·ª©c') || lowerMessage.includes('news') || lowerMessage.includes('b√†i vi·∫øt')) {
        if (chatbotData.tinTuc.length > 0) {
            const latestNews = chatbotData.tinTuc.slice(0, 3);
            let response = 'üì∞ Tin t·ª©c m·ªõi nh·∫•t:\n\n';
            latestNews.forEach(tt => {
                response += `üìÑ ${tt.tieuDe}\n   ${tt.tomTat || tt.noiDung.substring(0, 100) + '...'}\n\n`;
            });
            response += 'B·∫°n c√≥ th·ªÉ ƒë·ªçc th√™m t·∫°i trang Tin t·ª©c!';
            return response;
        }
        return 'üì∞ Ch√∫ng t√¥i th∆∞·ªùng xuy√™n c·∫≠p nh·∫≠t c√°c b√†i vi·∫øt v·ªÅ dinh d∆∞·ª°ng cho b√©. B·∫°n c√≥ th·ªÉ xem t·∫°i trang Tin t·ª©c!';
    }
    
    if (lowerMessage.includes('danh m·ª•c') || lowerMessage.includes('category') || lowerMessage.includes('lo·∫°i')) {
        if (chatbotData.danhMuc.length > 0) {
            const mainCats = chatbotData.danhMuc.filter(dm => !dm.danhMucCha_id);
            let response = 'üìÇ Danh m·ª•c s·∫£n ph·∫©m:\n\n';
            mainCats.forEach(dm => {
                response += `${dm.icon || 'üìÅ'} ${dm.tenDanhMuc}\n   ${dm.moTa || ''}\n\n`;
            });
            response += 'B·∫°n c√≥ th·ªÉ xem chi ti·∫øt t·∫°i trang Th·ª±c ƒë∆°n!';
            return response;
        }
        return 'üìÇ Ch√∫ng t√¥i c√≥ nhi·ªÅu danh m·ª•c ch√°o dinh d∆∞·ª°ng ph√π h·ª£p v·ªõi t·ª´ng ƒë·ªô tu·ªïi c·ªßa b√©. B·∫°n c√≥ th·ªÉ xem t·∫°i trang Th·ª±c ƒë∆°n!';
    }
    
    if (lowerMessage.includes('ch√†o') || lowerMessage.includes('hello') || lowerMessage.includes('hi') || 
        lowerMessage.includes('xin ch√†o') || lowerMessage.includes('alo')) {
        const productCount = chatbotData.sanPham.length || 10;
        const promoCount = chatbotData.khuyenMai.length || 0;
        let response = `Xin ch√†o! üëã T√¥i l√† BabyCutie Bot, r·∫•t vui ƒë∆∞·ª£c h·ªó tr·ª£ b·∫°n.\n\n`;
        response += `üç≤ Ch√∫ng t√¥i c√≥ ${productCount} m√≥n ch√°o dinh d∆∞·ª°ng cho b√©`;
        if (promoCount > 0) {
            response += `\nüéÅ ƒêang c√≥ ${promoCount} ch∆∞∆°ng tr√¨nh khuy·∫øn m√£i`;
        }
        response += `\n\nB·∫°n c√≥ th·ªÉ h·ªèi t√¥i v·ªÅ:\n`;
        response += `‚Ä¢ üí∞ Gi√° s·∫£n ph·∫©m\n`;
        response += `‚Ä¢ üç≤ Th√¥ng tin m√≥n ch√°o\n`;
        response += `‚Ä¢ üõí C√°ch ƒë·∫∑t h√†ng\n`;
        response += `‚Ä¢ üéÅ Khuy·∫øn m√£i\n`;
        response += `‚Ä¢ üì∞ Tin t·ª©c\n`;
        response += `‚Ä¢ üìû Li√™n h·ªá\n\nB·∫°n mu·ªën bi·∫øt g√¨? üòä`;
        return response;
    }
    
    if (lowerMessage.includes('c·∫£m ∆°n') || lowerMessage.includes('thank') || lowerMessage.includes('thanks')) {
        return 'Kh√¥ng c√≥ g√¨! üòä N·∫øu b·∫°n c√≥ th√™m c√¢u h·ªèi n√†o kh√°c, ƒë·ª´ng ng·∫ßn ng·∫°i h·ªèi t√¥i nh√©. Ch√∫c b·∫°n v√† b√© y√™u m·ªôt ng√†y t·ªët l√†nh! ‚ù§Ô∏è';
    }
    
    // T√¨m ki·∫øm m∆° h·ªì - g·ª£i √Ω s·∫£n ph·∫©m
    if (lowerMessage.length > 2 && lowerMessage.length < 20) {
        const suggestions = chatbotData.sanPham.filter(sp => {
            const tenSP = (sp.tenSanPham || '').toLowerCase();
            return tenSP.includes(lowerMessage) || lowerMessage.split(' ').some(word => 
                word.length > 2 && tenSP.includes(word)
            );
        }).slice(0, 3);
        
        if (suggestions.length > 0) {
            let response = `üîç C√≥ th·ªÉ b·∫°n ƒëang t√¨m:\n\n`;
            suggestions.forEach((sp, idx) => {
                const gia = sp.giaVua || sp.gia;
                response += `${idx + 1}. ${sp.tenSanPham} - ${parseInt(gia).toLocaleString('vi-VN')}ƒë\n`;
            });
            response += `\nB·∫°n c√≥ th·ªÉ h·ªèi chi ti·∫øt v·ªÅ b·∫•t k·ª≥ m√≥n n√†o!`;
            return response;
        }
    }
    
    // Default response
    return 'Xin l·ªói, t√¥i ch∆∞a hi·ªÉu r√µ c√¢u h·ªèi c·ªßa b·∫°n. üòÖ\n\nB·∫°n c√≥ th·ªÉ h·ªèi t√¥i v·ªÅ:\n‚Ä¢ üí∞ Gi√° s·∫£n ph·∫©m\n‚Ä¢ üç≤ T√™n m√≥n ch√°o (v√≠ d·ª•: "ch√°o c√° h·ªìi", "ch√°o g√†")\n‚Ä¢ üõí C√°ch ƒë·∫∑t h√†ng\n‚Ä¢ üöö Th·ªùi gian giao h√†ng\n‚Ä¢ üí≥ Ph∆∞∆°ng th·ª©c thanh to√°n\n‚Ä¢ üéÅ Khuy·∫øn m√£i\n‚Ä¢ üì∞ Tin t·ª©c\n‚Ä¢ üë∂ ƒê·ªô tu·ªïi ph√π h·ª£p\n‚Ä¢ üìû Th√¥ng tin li√™n h·ªá\n\nHo·∫∑c b·∫°n c√≥ th·ªÉ g·ªçi hotline 1900 1234 ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n tr·ª±c ti·∫øp! üìû';
}

</script>

</body>
</html>
