<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>BabyCutie â€“ ChÃ¡o dinh dÆ°á»¡ng cho bÃ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/home.css">
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="header">
    <div class="container header-wrap">

        <!-- MOBILE MENU TOGGLE -->
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </button>

        <!-- LOGO -->
        <div class="logo" onclick="window.location='index.html'">
            <img src="images/logo2.jpg" alt="BabyCutie">
            <span>BabyCutie</span>
        </div>

        <!-- SEARCH -->
        <div class="search">
            <i class="fa fa-search"></i>
            <input type="text" id="searchInput" placeholder="TÃ¬m mÃ³n Äƒn cho bÃ©..." onkeyup="handleSearch(event)">
        </div>

        <!-- DESKTOP MENU -->
        <nav class="main-menu">
            <a href="index.html" class="active">Trang chá»§</a>
            <a href="thuc-don.html">Thá»±c Ä‘Æ¡n</a>
            <a href="khuyen-mai.html">Khuyáº¿n mÃ£i</a>
            <a href="tin-tuc.html">Tin tá»©c</a>
            <a href="lien-he.html">LiÃªn há»‡</a>
        </nav>

        <!-- CART -->
        <div class="cart-icon" onclick="window.location='gio-hang.html'">
            <i class="fa-solid fa-cart-shopping"></i>
            <span class="cart-count" id="cartCount">0</span>
        </div>

        <!-- LOGIN / USER INFO -->
        <div class="login-group">
            <div id="userInfo" style="display: none;">
                <div class="dropdown">
                    <button class="btn-login dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fa fa-user"></i> <span id="userName"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="don-hang-cua-toi.html">ğŸ“¦ ÄÆ¡n hÃ ng cá»§a tÃ´i</a></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()">ÄÄƒng xuáº¥t</a></li>
                    </ul>
                </div>
            </div>
            <div id="loginBtn">
            <div class="dropdown">
                <button class="btn-login dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fa fa-user"></i> <span class="d-none d-md-inline">ÄÄƒng nháº­p</span>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a class="dropdown-item" href="login-khach.html">
                            ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ KhÃ¡ch hÃ ng
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="login-admin.html">
                            ğŸ›  Admin
                        </a>
                    </li>
                </ul>
                </div>
            </div>
        </div>

    </div>
</header>

<!-- MOBILE MENU -->
<div class="mobile-menu" id="mobileMenu">
    <button class="mobile-menu-close" onclick="toggleMobileMenu()">
        <i class="fas fa-times"></i>
    </button>
    <nav>
        <a href="index.html" class="active" onclick="toggleMobileMenu()">ğŸ  Trang chá»§</a>
        <a href="thuc-don.html" onclick="toggleMobileMenu()">ğŸ² Thá»±c Ä‘Æ¡n</a>
        <a href="khuyen-mai.html" onclick="toggleMobileMenu()">ğŸ‰ Khuyáº¿n mÃ£i</a>
        <a href="tin-tuc.html" onclick="toggleMobileMenu()">ğŸ“° Tin tá»©c</a>
        <a href="lien-he.html" onclick="toggleMobileMenu()">ğŸ“ LiÃªn há»‡</a>
        <a href="gio-hang.html" onclick="toggleMobileMenu()">ğŸ›’ Giá» hÃ ng</a>
        <a href="login-khach.html" onclick="toggleMobileMenu()">ğŸ‘¤ ÄÄƒng nháº­p</a>
    </nav>
</div>

<!-- ================= HERO ================= -->
<section class="hero">
    <div class="container hero-wrap">

        <div class="hero-text">
            <h1>
                Dinh dÆ°á»¡ng trá»n váº¹n <br>
                cho bÃ© yÃªu khÃ´n lá»›n
            </h1>
            <p>
                ChÃ¡o dinh dÆ°á»¡ng BabyCutie Ä‘Æ°á»£c náº¥u má»—i ngÃ y
                tá»« nguyÃªn liá»‡u tÆ°Æ¡i sáº¡ch â€“ an toÃ n â€“ khoa há»c.
            </p>

            <div class="hero-btn">
                <button class="btn-primary" onclick="window.location='thuc-don.html'">
                    Äáº·t mÃ³n ngay
                </button>
                <button class="btn-outline" onclick="window.location='thuc-don.html'">
                    Xem thá»±c Ä‘Æ¡n
                </button>
            </div>
        </div>

        <div class="hero-img">
            <img src="images/trem.jpg" alt="ChÃ¡o dinh dÆ°á»¡ng">
        </div>

    </div>
</section>

<!-- ================= BENEFIT ================= -->
<section class="benefit">
    <div class="container text-center">
        <h2>Lá»£i Ã­ch khi chá»n BabyCutie</h2>
        <p class="sub">ChÃºng tÃ´i Ä‘áº·t sá»©c khá»e cá»§a bÃ© lÃªn hÃ ng Ä‘áº§u</p>

        <div class="row mt-4">
            <div class="col-md-4">
                <div class="benefit-card">
                    ğŸŒ±
                    <h5>NguyÃªn liá»‡u tÆ°Æ¡i sáº¡ch</h5>
                    <p>100% thá»±c pháº©m rÃµ nguá»“n gá»‘c</p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="benefit-card">
                    â¤ï¸
                    <h5>CÃ¢n báº±ng dinh dÆ°á»¡ng</h5>
                    <p>Thá»±c Ä‘Æ¡n theo tá»«ng Ä‘á»™ tuá»•i</p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="benefit-card">
                    ğŸšš
                    <h5>Giao hÃ ng nhanh</h5>
                    <p>Giao trong ngÃ y â€“ giá»¯ trá»n Ä‘á»™ nÃ³ng</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================= FEATURED PRODUCT ================= -->
<section class="product">
    <div class="container">
        <div class="product-head">
            <h2>Sáº£n pháº©m ná»•i báº­t</h2>
            <a href="thuc-don.html">Xem táº¥t cáº£ â†’</a>
        </div>

        <!-- JS sáº½ render sáº£n pháº©m á»Ÿ Ä‘Ã¢y -->
        <div class="row" id="sanPhamNoiBat">
            <!-- sáº£n pháº©m tá»« API -->
        </div>
    </div>
</section>

<!-- ================= PROMOTIONS ================= -->
<section class="promotions">
    <div class="container">
        <div class="promotions-head text-center mb-5">
            <h2>ğŸ‰ MÃ£ Khuyáº¿n MÃ£i Hot</h2>
            <p class="sub">Nháº­n ngay Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t khi Ä‘áº·t hÃ ng</p>
        </div>

        <!-- JS sáº½ render mÃ£ khuyáº¿n mÃ£i á»Ÿ Ä‘Ã¢y -->
        <div class="row" id="khuyenMaiList">
            <div class="col-12 text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Äang táº£i mÃ£ khuyáº¿n mÃ£i...</p>
            </div>
        </div>
    </div>
</section>

<!-- ================= STATISTICS ================= -->
<section class="statistics">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-icon">ğŸ‘¶</div>
                    <h3 class="stat-number" data-target="5000">0</h3>
                    <p>BÃ© yÃªu Ä‘Ã£ tin dÃ¹ng</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-icon">ğŸ²</div>
                    <h3 class="stat-number" data-target="50">0</h3>
                    <p>MÃ³n chÃ¡o dinh dÆ°á»¡ng</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-icon">â­</div>
                    <h3 class="stat-number" data-target="98">0</h3>
                    <p>% KhÃ¡ch hÃ ng hÃ i lÃ²ng</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-icon">ğŸšš</div>
                    <h3 class="stat-number" data-target="24">0</h3>
                    <p>Giá» giao hÃ ng</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================= PROCESS ================= -->
<section class="process">
    <div class="container">
        <h2 class="text-center mb-5">Quy trÃ¬nh Ä‘áº·t hÃ ng Ä‘Æ¡n giáº£n</h2>
        <div class="row">
            <div class="col-md-3 col-6">
                <div class="process-item">
                    <div class="process-number">1</div>
                    <div class="process-icon">ğŸ›’</div>
                    <h5>Chá»n mÃ³n</h5>
                    <p>Xem thá»±c Ä‘Æ¡n vÃ  chá»n mÃ³n yÃªu thÃ­ch</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="process-item">
                    <div class="process-number">2</div>
                    <div class="process-icon">ğŸ“</div>
                    <h5>Äáº·t hÃ ng</h5>
                    <p>ThÃªm vÃ o giá» vÃ  Ä‘iá»n thÃ´ng tin</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="process-item">
                    <div class="process-number">3</div>
                    <div class="process-icon">ğŸ’³</div>
                    <h5>Thanh toÃ¡n</h5>
                    <p>Thanh toÃ¡n COD hoáº·c chuyá»ƒn khoáº£n</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="process-item">
                    <div class="process-number">4</div>
                    <div class="process-icon">ğŸšš</div>
                    <h5>Nháº­n hÃ ng</h5>
                    <p>Giao hÃ ng táº­n nÆ¡i nÃ³ng há»•i</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================= TESTIMONIALS ================= -->
<section class="testimonials">
    <div class="container">
        <h2 class="text-center mb-5">KhÃ¡ch hÃ ng nÃ³i gÃ¬ vá» chÃºng tÃ´i</h2>
        <div class="row">
            <div class="col-md-4">
                <div class="testimonial-card">
                    <div class="testimonial-stars">â­â­â­â­â­</div>
                    <p class="testimonial-text">"BÃ© nhÃ  mÃ¬nh ráº¥t thÃ­ch chÃ¡o cÃ¡ há»“i bÃ­ Ä‘á». MÃ³n Äƒn thÆ¡m ngon, Ä‘áº§y Ä‘á»§ dinh dÆ°á»¡ng. Cáº£m Æ¡n BabyCutie!"</p>
                    <div class="testimonial-author">
                        <strong>Chá»‹ Lan</strong>
                        <span>Máº¹ bÃ© Minh (8 thÃ¡ng)</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="testimonial-card">
                    <div class="testimonial-stars">â­â­â­â­â­</div>
                    <p class="testimonial-text">"Giao hÃ ng nhanh, chÃ¡o cÃ²n nÃ³ng. BÃ© Äƒn ngon miá»‡ng, tÄƒng cÃ¢n Ä‘á»u. Ráº¥t hÃ i lÃ²ng vá»›i dá»‹ch vá»¥!"</p>
                    <div class="testimonial-author">
                        <strong>Chá»‹ HÆ°Æ¡ng</strong>
                        <span>Máº¹ bÃ© An (1 tuá»•i)</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="testimonial-card">
                    <div class="testimonial-stars">â­â­â­â­â­</div>
                    <p class="testimonial-text">"Thá»±c Ä‘Æ¡n Ä‘a dáº¡ng, giÃ¡ cáº£ há»£p lÃ½. Äáº·c biá»‡t lÃ  nguyÃªn liá»‡u tÆ°Æ¡i sáº¡ch, an toÃ n cho bÃ©."</p>
                    <div class="testimonial-author">
                        <strong>Anh Tuáº¥n</strong>
                        <span>Bá»‘ bÃ© Mai (10 thÃ¡ng)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================= CTA SECTION ================= -->
<section class="cta-section">
    <div class="container">
        <div class="cta-box">
            <h2>Äáº·t hÃ ng ngay hÃ´m nay!</h2>
            <p>Nháº­n Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t cho khÃ¡ch hÃ ng má»›i</p>
            <div class="cta-buttons">
                <button class="btn-primary btn-lg" onclick="window.location='thuc-don.html'">
                    <i class="fa fa-shopping-cart"></i> Xem thá»±c Ä‘Æ¡n
                </button>
                <button class="btn-outline btn-lg" onclick="window.location='register-khach.html'">
                    <i class="fa fa-user-plus"></i> ÄÄƒng kÃ½ ngay
                </button>
            </div>
        </div>
</div>
</section>


<!-- ================= FOOTER ================= -->
<footer class="footer">
    <div class="container footer-wrap">
        <div>
            <b>BabyCutie</b>
            <p>ChÃ¡o dinh dÆ°á»¡ng cho bÃ© yÃªu</p>
        </div>
        <div>
            <p>ğŸ“ Hotline: 1900 1234</p>
            <p>ğŸ“§ babycutie@gmail.com</p>
        </div>
    </div>
</footer>

<!-- ================= TOAST NOTIFICATION ================= -->
<div id="toast" class="toast-notification"></div>

<!-- ================= CHATBOT WIDGET ================= -->
<div id="chatbotWidget" class="chatbot-widget">
    <!-- Chat Button -->
    <div id="chatbotButton" class="chatbot-button" onclick="toggleChatbot()">
        <i class="fas fa-comments"></i>
        <span class="chatbot-badge">1</span>
    </div>
    
    <!-- Chat Window -->
    <div id="chatbotWindow" class="chatbot-window">
        <div class="chatbot-header">
            <div class="chatbot-header-info">
                <div class="chatbot-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <h5>BabyCutie Bot</h5>
                    <span class="chatbot-status">Äang trá»±c tuyáº¿n</span>
                </div>
            </div>
            <button class="chatbot-close" onclick="toggleChatbot()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="chatbot-message bot-message">
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <p>Xin chÃ o! ğŸ‘‹ TÃ´i lÃ  BabyCutie Bot, tÃ´i cÃ³ thá»ƒ giÃºp gÃ¬ cho báº¡n?</p>
                </div>
            </div>
            
            <!-- Quick Questions -->
            <div class="quick-questions">
                <p class="quick-questions-title">CÃ¢u há»i thÆ°á»ng gáº·p:</p>
                <button class="quick-question-btn" onclick="sendQuickQuestion('GiÃ¡ sáº£n pháº©m nhÆ° tháº¿ nÃ o?')">
                    ğŸ’° GiÃ¡ sáº£n pháº©m
                </button>
                <button class="quick-question-btn" onclick="sendQuickQuestion('CÃ¡ch Ä‘áº·t hÃ ng?')">
                    ğŸ›’ CÃ¡ch Ä‘áº·t hÃ ng
                </button>
                <button class="quick-question-btn" onclick="sendQuickQuestion('Thá»i gian giao hÃ ng?')">
                    ğŸšš Thá»i gian giao hÃ ng
                </button>
                <button class="quick-question-btn" onclick="sendQuickQuestion('PhÆ°Æ¡ng thá»©c thanh toÃ¡n?')">
                    ğŸ’³ Thanh toÃ¡n
                </button>
            </div>
        </div>
        
        <div class="chatbot-input-area">
            <input 
                type="text" 
                id="chatbotInput" 
                class="chatbot-input" 
                placeholder="Nháº­p cÃ¢u há»i cá»§a báº¡n..."
                onkeypress="handleChatbotKeyPress(event)"
            >
            <button class="chatbot-send-btn" onclick="sendChatbotMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</div>

<!-- ================= JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const API_URL = "http://127.0.0.1:5000/api/thuc-don";
const sanPhamNoiBat = document.getElementById("sanPhamNoiBat");

// Toast notification function
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = `toast-notification ${type} show`;
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Kiá»ƒm tra Ä‘Äƒng nháº­p vÃ  hiá»ƒn thá»‹ thÃ´ng tin
const token = localStorage.getItem("token");
const userInfo = JSON.parse(localStorage.getItem("user_info") || '{}');

if (token && userInfo.hoTen) {
    document.getElementById("userInfo").style.display = "block";
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("userName").textContent = userInfo.hoTen;
} else {
    document.getElementById("userInfo").style.display = "none";
    document.getElementById("loginBtn").style.display = "block";
}

function logout() {
    localStorage.removeItem("token");
    localStorage.removeItem("user_info");
    showToast("ÄÃ£ Ä‘Äƒng xuáº¥t thÃ nh cÃ´ng", "info");
    setTimeout(() => {
        location.reload();
    }, 1000);
}

// Load sáº£n pháº©m ná»•i báº­t vá»›i loading state
function loadSanPhamNoiBat() {
    // Hiá»ƒn thá»‹ loading
    sanPhamNoiBat.innerHTML = `
        <div class="col-12 text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Äang táº£i sáº£n pháº©m...</p>
        </div>
    `;

fetch(API_URL)
        .then(res => {
            if (!res.ok) throw new Error('Network response was not ok');
            return res.json();
        })
    .then(data => {
        // Láº¥y tá»‘i Ä‘a 6 sáº£n pháº©m Ä‘áº§u
        const dsNoiBat = data.slice(0, 6);
        let html = "";

            if (dsNoiBat.length === 0) {
                html = `
                    <div class="col-12 text-center py-5">
                        <p class="text-muted">ChÆ°a cÃ³ sáº£n pháº©m nÃ o</p>
                    </div>
                `;
            } else {
        dsNoiBat.forEach(sp => {
            html += `
                <div class="col-md-4 mb-4">
                            <div class="product-card" onclick="viewProductDetail(${sp.id})" style="cursor: pointer;">
                                <div class="product-image-wrapper">
                                    <img 
                                        src="http://127.0.0.1:5000/images/${sp.hinhAnh || 'default.jpg'}" 
                                        alt="${sp.tenSanPham}"
                                        onerror="this.src='images/default.jpg'"
                                    >
                                    <div class="product-overlay">
                                        <button class="btn-quick-view" onclick="event.stopPropagation(); viewProductDetail(${sp.id})">
                                            <i class="fa fa-eye"></i> Xem chi tiáº¿t
                                        </button>
                                    </div>
                                </div>
                                <div class="product-info">
                                    <h5>${sp.tenSanPham}</h5>
                                    <p class="price">${Number(sp.gia).toLocaleString('vi-VN')}Ä‘</p>
                                    
                                    ${sp.moTa ? `<p class="desc">${sp.moTa.substring(0, 60)}${sp.moTa.length > 60 ? '...' : ''}</p>` : ''}

                        <div class="nutrition">
                                        <span>ğŸ’ª <b>${sp.protein || 0}g</b></span>
                                        <span>ğŸš <b>${sp.carb || 0}g</b></span>
                                        <span>ğŸ¥‘ <b>${sp.chatBeo || 0}g</b></span>
                        </div>

                                    ${sp.doTuoi ? `<small class="age">ğŸ‘¶ ${sp.doTuoi}</small>` : ''}
                                    
                                    <button class="btn-add-cart" onclick="event.stopPropagation(); addToCart(${sp.id})">
                                        <i class="fa fa-cart-plus"></i> ThÃªm vÃ o giá»
                        </button>
                                </div>
                    </div>
                </div>
            `;
        });
            }

        sanPhamNoiBat.innerHTML = html;
    })
    .catch(err => {
        console.error("Lá»—i load sáº£n pháº©m:", err);
            sanPhamNoiBat.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fa fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                    <p class="mt-3 text-muted">KhÃ´ng thá»ƒ táº£i sáº£n pháº©m. Vui lÃ²ng thá»­ láº¡i sau.</p>
                    <button class="btn btn-primary mt-2" onclick="loadSanPhamNoiBat()">
                        <i class="fa fa-refresh"></i> Thá»­ láº¡i
                    </button>
                </div>
            `;
        });
}

// Xem chi tiáº¿t sáº£n pháº©m
function viewProductDetail(id) {
    window.location.href = `chi-tiet-san-pham.html?id=${id}`;
}

// ThÃªm vÃ o giá» hÃ ng vá»›i loading state
function addToCart(id) {
    if (!token) {
        showToast("Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ thÃªm vÃ o giá» hÃ ng", "warning");
        setTimeout(() => {
            window.location.href = "login-khach.html";
        }, 1500);
        return;
    }

    // Disable button vÃ  hiá»ƒn thá»‹ loading
    const buttons = document.querySelectorAll(`button[onclick*="addToCart(${id})"]`);
    buttons.forEach(btn => {
        btn.disabled = true;
        btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Äang thÃªm...';
    });

    fetch("http://127.0.0.1:5000/api/gio-hang", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify({
            sanPham_id: id,
            soLuong: 1
        })
    })
    .then(res => res.json())
    .then(data => {
        // Re-enable buttons
        buttons.forEach(btn => {
            btn.disabled = false;
            btn.innerHTML = '<i class="fa fa-cart-plus"></i> ThÃªm vÃ o giá»';
        });

        if (data.success) {
            showToast("âœ… ÄÃ£ thÃªm vÃ o giá» hÃ ng!", "success");
            updateCartCount();
            // Cáº­p nháº­t sá»‘ lÆ°á»£ng trÃªn nÃºt
            updateProductButtonQuantity(id);
            // Animation cho cart icon
            const cartIcon = document.querySelector('.cart-icon');
            cartIcon.classList.add('bounce');
            setTimeout(() => cartIcon.classList.remove('bounce'), 500);
        } else {
            showToast("Lá»—i: " + (data.message || "KhÃ´ng thá»ƒ thÃªm vÃ o giá»"), "error");
        }
    })
    .catch(err => {
        buttons.forEach(btn => {
            btn.disabled = false;
            btn.innerHTML = '<i class="fa fa-cart-plus"></i> ThÃªm vÃ o giá»';
        });
        showToast("Lá»—i káº¿t ná»‘i. Vui lÃ²ng thá»­ láº¡i.", "error");
        console.error("Error:", err);
    });
}

// Cáº­p nháº­t sá»‘ lÆ°á»£ng giá» hÃ ng
function updateCartCount() {
    if (!token) {
        const cartCountEl = document.getElementById("cartCount");
        if (cartCountEl) cartCountEl.textContent = "0";
        return;
    }
    
    fetch("http://127.0.0.1:5000/api/gio-hang", {
        headers: {"Authorization": "Bearer " + token}
    })
    .then(res => {
        if (!res.ok) throw new Error('Failed to fetch cart');
        return res.json();
    })
    .then(data => {
        const total = data.reduce((sum, item) => sum + item.soLuong, 0);
        const cartCountEl = document.getElementById("cartCount");
        if (cartCountEl) {
            cartCountEl.textContent = total;
            
            // Hiá»ƒn thá»‹/áº©n badge
            if (total > 0) {
                cartCountEl.style.display = "flex";
                // Animation
                cartCountEl.classList.add("bounce");
                setTimeout(() => cartCountEl.classList.remove("bounce"), 500);
            } else {
                cartCountEl.style.display = "none";
            }
        }
    })
    .catch(() => {
        const cartCountEl = document.getElementById("cartCount");
        if (cartCountEl) cartCountEl.textContent = "0";
    });
}

// Cáº­p nháº­t sá»‘ lÆ°á»£ng trÃªn nÃºt sáº£n pháº©m
function updateProductButtonQuantity(sanPhamId) {
    if (!token) return;

    fetch("http://127.0.0.1:5000/api/gio-hang", {
        headers: {"Authorization": "Bearer " + token}
    })
    .then(res => res.json())
    .then(cartItems => {
        const item = cartItems.find(i => i.sanPham_id === sanPhamId);
        const buttons = document.querySelectorAll(`button[onclick*="addToCart(${sanPhamId})"]`);
        
        buttons.forEach(btn => {
            if (item && item.soLuong > 0) {
                btn.innerHTML = `<i class="fa fa-cart-plus"></i> ÄÃ£ thÃªm (${item.soLuong})`;
                btn.style.background = "linear-gradient(135deg, #28a745, #20c997)";
                btn.style.color = "#fff";
            } else {
                btn.innerHTML = '<i class="fa fa-cart-plus"></i> ThÃªm vÃ o giá»';
                btn.style.background = "";
                btn.style.color = "";
            }
        });
    })
    .catch(err => console.error("Error updating button:", err));
}

// Cáº­p nháº­t táº¥t cáº£ nÃºt sáº£n pháº©m khi load
function updateAllProductButtons() {
    if (!token) return;

    fetch("http://127.0.0.1:5000/api/gio-hang", {
        headers: {"Authorization": "Bearer " + token}
    })
    .then(res => res.json())
    .then(cartItems => {
        cartItems.forEach(item => {
            updateProductButtonQuantity(item.sanPham_id);
        });
    })
    .catch(err => console.error("Error:", err));
}

// Search functionality - Enter key vÃ  click icon
function handleSearch(event) {
    if (event.key === 'Enter' || event.type === 'click') {
        const searchInput = document.getElementById('searchInput');
        const keyword = searchInput.value.trim();
        if (keyword) {
            window.location.href = `thuc-don.html?search=${encodeURIComponent(keyword)}`;
        } else {
            showToast("Vui lÃ²ng nháº­p tá»« khÃ³a tÃ¬m kiáº¿m", "warning");
        }
    }
}

// Mobile Menu Toggle
function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobileMenu');
    if (mobileMenu) {
        mobileMenu.classList.toggle('active');
        // Prevent body scroll when menu is open
        if (mobileMenu.classList.contains('active')) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = '';
        }
    }
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
    const mobileMenu = document.getElementById('mobileMenu');
    const menuToggle = document.querySelector('.mobile-menu-toggle');
    
    if (mobileMenu && !mobileMenu.contains(event.target) && 
        menuToggle && !menuToggle.contains(event.target) &&
        mobileMenu.classList.contains('active')) {
        toggleMobileMenu();
    }
});

// ThÃªm event listener cho search icon
document.addEventListener('DOMContentLoaded', () => {
    const searchIcon = document.querySelector('.search i.fa-search');
    if (searchIcon) {
        searchIcon.addEventListener('click', handleSearch);
        searchIcon.style.cursor = 'pointer';
    }
    
    // Load sáº£n pháº©m
    loadSanPhamNoiBat();
    
    // Load mÃ£ khuyáº¿n mÃ£i
    loadKhuyenMai();
    
    // Update cart count náº¿u Ä‘Ã£ Ä‘Äƒng nháº­p
    if (token) {
        updateCartCount();
    }
    
    // Initialize animations
    animateStats();
    animateOnScroll();
});

// ================= LOAD MÃƒ KHUYáº¾N MÃƒI =================
function loadKhuyenMai() {
    const khuyenMaiList = document.getElementById("khuyenMaiList");
    
    // Chá»‰ láº¥y mÃ£ Ä‘ang hoáº¡t Ä‘á»™ng cho trang chá»§
    fetch("http://127.0.0.1:5000/api/khuyen-mai?only_active=true")
        .then(res => {
            if (!res.ok) throw new Error('Network response was not ok');
            return res.json();
        })
        .then(data => {
            if (!data || data.length === 0) {
                khuyenMaiList.innerHTML = `
                    <div class="col-12">
                        <div class="promotions-empty">
                            <i class="fa fa-tag"></i>
                            <p>Hiá»‡n táº¡i chÆ°a cÃ³ mÃ£ khuyáº¿n mÃ£i nÃ o</p>
                            <p class="text-muted">Vui lÃ²ng quay láº¡i sau Ä‘á»ƒ nháº­n Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t!</p>
                        </div>
                    </div>
                `;
                return;
            }

            let html = "";
            data.forEach(km => {
                const loaiGiam = km.loaiGiamGia === "phan_tram" ? "%" : "Ä‘";
                const giaTriGiam = km.loaiGiamGia === "phan_tram" 
                    ? `${km.giaTriGiam}%` 
                    : `${Number(km.giaTriGiam).toLocaleString('vi-VN')}Ä‘`;
                
                const ngayBatDau = km.ngayBatDau ? new Date(km.ngayBatDau).toLocaleDateString('vi-VN') : 'N/A';
                const ngayKetThuc = km.ngayKetThuc ? new Date(km.ngayKetThuc).toLocaleDateString('vi-VN') : 'N/A';
                
                html += `
                    <div class="col-md-4 mb-4">
                        <div class="promotion-card">
                            <span class="promotion-badge">ğŸ‰ Khuyáº¿n mÃ£i</span>
                            <h4 class="promotion-title">${km.tenKhuyenMai}</h4>
                            
                            <div class="promotion-discount">Giáº£m ${giaTriGiam}</div>
                            
                            <div class="promotion-code-wrapper">
                                <span class="promotion-code">${km.maKhuyenMai}</span>
                                <button class="btn-copy-code" onclick="copyPromoCode('${km.maKhuyenMai}', this)">
                                    <i class="fa fa-copy"></i> Copy
                                </button>
                            </div>
                            
                            <div class="promotion-details">
                                ${km.donHangToiThieu ? `
                                    <div class="promotion-detail-item">
                                        <i class="fa fa-shopping-cart"></i>
                                        <span>ÄÆ¡n hÃ ng tá»‘i thiá»ƒu: <strong>${Number(km.donHangToiThieu).toLocaleString('vi-VN')}Ä‘</strong></span>
                                    </div>
                                ` : ''}
                                ${km.giaTriToiDa && km.loaiGiamGia === "phan_tram" ? `
                                    <div class="promotion-detail-item">
                                        <i class="fa fa-gift"></i>
                                        <span>Giáº£m tá»‘i Ä‘a: <strong>${Number(km.giaTriToiDa).toLocaleString('vi-VN')}Ä‘</strong></span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="promotion-validity">
                                <i class="fa fa-calendar"></i>
                                <strong>Ãp dá»¥ng:</strong> ${ngayBatDau} - ${ngayKetThuc}
                            </div>
                        </div>
                    </div>
                `;
            });

            khuyenMaiList.innerHTML = html;
        })
        .catch(err => {
            console.error("Lá»—i load mÃ£ khuyáº¿n mÃ£i:", err);
            khuyenMaiList.innerHTML = `
                <div class="col-12">
                    <div class="promotions-empty">
                        <i class="fa fa-exclamation-triangle text-warning"></i>
                        <p>KhÃ´ng thá»ƒ táº£i mÃ£ khuyáº¿n mÃ£i</p>
                        <button class="btn btn-primary mt-2" onclick="loadKhuyenMai()">
                            <i class="fa fa-refresh"></i> Thá»­ láº¡i
                        </button>
                    </div>
                </div>
            `;
        });
}

// ================= COPY MÃƒ KHUYáº¾N MÃƒI =================
function copyPromoCode(code, button) {
    // Copy to clipboard
    navigator.clipboard.writeText(code).then(() => {
        // Update button
        const originalHTML = button.innerHTML;
        button.innerHTML = '<i class="fa fa-check"></i> ÄÃ£ copy!';
        button.classList.add('copied');
        
        // Show toast
        showToast(`âœ… ÄÃ£ copy mÃ£ "${code}"! Báº¡n cÃ³ thá»ƒ dÃ¡n vÃ o Ã´ mÃ£ khuyáº¿n mÃ£i khi thanh toÃ¡n.`, "success");
        
        // Reset button after 2 seconds
        setTimeout(() => {
            button.innerHTML = originalHTML;
            button.classList.remove('copied');
        }, 2000);
    }).catch(err => {
        // Fallback for older browsers
        const textArea = document.createElement("textarea");
        textArea.value = code;
        textArea.style.position = "fixed";
        textArea.style.opacity = "0";
        document.body.appendChild(textArea);
        textArea.select();
        
        try {
            document.execCommand('copy');
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fa fa-check"></i> ÄÃ£ copy!';
            button.classList.add('copied');
            showToast(`âœ… ÄÃ£ copy mÃ£ "${code}"!`, "success");
            
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.classList.remove('copied');
            }, 2000);
        } catch (err) {
            showToast("âŒ KhÃ´ng thá»ƒ copy mÃ£. Vui lÃ²ng ghi nhá»› mÃ£: " + code, "error");
        }
        
        document.body.removeChild(textArea);
    });
}

// Animate statistics vá»›i cáº£i thiá»‡n
function animateStats() {
    const stats = document.querySelectorAll('.stat-number');
    if (stats.length === 0) return;
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && !entry.target.classList.contains('animated')) {
                entry.target.classList.add('animated');
                const target = parseInt(entry.target.getAttribute('data-target'));
                const isPercent = entry.target.getAttribute('data-target') === '98';
                const duration = 2000;
                const increment = target / (duration / 16);
                let current = 0;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        entry.target.textContent = target + (isPercent ? '%' : '+');
                        clearInterval(timer);
                    } else {
                        entry.target.textContent = Math.floor(current) + (isPercent ? '%' : '+');
                    }
                }, 16);
                
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.5 });
    
    stats.forEach(stat => observer.observe(stat));
}

// Animate elements on scroll
function animateOnScroll() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in-up');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });
    
    // Observe cÃ¡c sections
    document.querySelectorAll('.benefit-card, .process-item, .testimonial-card, .product-card').forEach(el => {
        observer.observe(el);
    });
}

// Smooth scroll cho cÃ¡c anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Lazy load images
if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                }
                observer.unobserve(img);
            }
        });
    });
    
    document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
    });
}

// ================= CHATBOT FUNCTIONALITY =================
let chatbotOpen = false;

// Toggle chatbot window
function toggleChatbot() {
    const chatbotWindow = document.getElementById('chatbotWindow');
    const chatbotButton = document.getElementById('chatbotButton');
    const chatbotBadge = document.querySelector('.chatbot-badge');
    
    chatbotOpen = !chatbotOpen;
    
    if (chatbotOpen) {
        chatbotWindow.classList.add('active');
        chatbotBadge.style.display = 'none';
        // Focus input
        setTimeout(() => {
            document.getElementById('chatbotInput').focus();
        }, 300);
    } else {
        chatbotWindow.classList.remove('active');
    }
}

// Send message from quick question button
function sendQuickQuestion(question) {
    document.getElementById('chatbotInput').value = question;
    sendChatbotMessage();
}

// Handle Enter key press
function handleChatbotKeyPress(event) {
    if (event.key === 'Enter') {
        sendChatbotMessage();
    }
}

// Send chatbot message
function sendChatbotMessage() {
    const input = document.getElementById('chatbotInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Add user message
    addChatbotMessage(message, 'user');
    input.value = '';
    
    // Show typing indicator
    showTypingIndicator();
    
    // Get bot response after delay
    setTimeout(() => {
        hideTypingIndicator();
        const botResponse = getBotResponse(message);
        addChatbotMessage(botResponse, 'bot');
    }, 1000);
}

// Add message to chat
function addChatbotMessage(message, type) {
    const messagesContainer = document.getElementById('chatbotMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `chatbot-message ${type}-message`;
    
    const avatarIcon = type === 'bot' ? 'fa-robot' : 'fa-user';
    
    // Convert newlines to <br> and preserve emojis
    const formattedMessage = message.replace(/\n/g, '<br>');
    
    messageDiv.innerHTML = `
        <div class="message-avatar">
            <i class="fas ${avatarIcon}"></i>
        </div>
        <div class="message-content">
            <p>${formattedMessage}</p>
        </div>
    `;
    
    messagesContainer.appendChild(messageDiv);
    
    // Scroll to bottom
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// Show typing indicator
function showTypingIndicator() {
    const messagesContainer = document.getElementById('chatbotMessages');
    const typingDiv = document.createElement('div');
    typingDiv.id = 'typingIndicator';
    typingDiv.className = 'chatbot-message bot-message';
    typingDiv.innerHTML = `
        <div class="message-avatar">
            <i class="fas fa-robot"></i>
        </div>
        <div class="message-content">
            <p><i class="fas fa-circle" style="font-size: 8px; animation: typing 1.4s infinite;"></i>
               <i class="fas fa-circle" style="font-size: 8px; animation: typing 1.4s infinite 0.2s;"></i>
               <i class="fas fa-circle" style="font-size: 8px; animation: typing 1.4s infinite 0.4s;"></i></p>
        </div>
    `;
    messagesContainer.appendChild(typingDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// Hide typing indicator
function hideTypingIndicator() {
    const typingIndicator = document.getElementById('typingIndicator');
    if (typingIndicator) {
        typingIndicator.remove();
    }
}

// Get bot response based on user message
function getBotResponse(message) {
    const lowerMessage = message.toLowerCase();
    
    // Keywords matching
    if (lowerMessage.includes('giÃ¡') || lowerMessage.includes('price') || lowerMessage.includes('cost')) {
        return 'ğŸ’° GiÃ¡ sáº£n pháº©m cá»§a chÃºng tÃ´i dao Ä‘á»™ng tá»« 25.000Ä‘ - 50.000Ä‘ tÃ¹y theo loáº¡i chÃ¡o. Báº¡n cÃ³ thá»ƒ xem chi tiáº¿t giÃ¡ táº¡i trang Thá»±c Ä‘Æ¡n. ChÃºng tÃ´i thÆ°á»ng xuyÃªn cÃ³ cÃ¡c chÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i háº¥p dáº«n!';
    }
    
    if (lowerMessage.includes('Ä‘áº·t hÃ ng') || lowerMessage.includes('order') || lowerMessage.includes('mua')) {
        return 'ğŸ›’ Äá»ƒ Ä‘áº·t hÃ ng, báº¡n cÃ³ thá»ƒ:\n1. Chá»n mÃ³n táº¡i trang Thá»±c Ä‘Æ¡n\n2. ThÃªm vÃ o giá» hÃ ng\n3. Äiá»n thÃ´ng tin vÃ  thanh toÃ¡n\n4. ChÃºng tÃ´i sáº½ giao hÃ ng táº­n nÆ¡i cho báº¡n!';
    }
    
    if (lowerMessage.includes('giao hÃ ng') || lowerMessage.includes('delivery') || lowerMessage.includes('ship')) {
        return 'ğŸšš ChÃºng tÃ´i giao hÃ ng trong ngÃ y, Ä‘áº£m báº£o chÃ¡o cÃ²n nÃ³ng há»•i khi Ä‘áº¿n tay báº¡n. Thá»i gian giao hÃ ng thÆ°á»ng tá»« 30 phÃºt - 2 giá» tÃ¹y theo Ä‘á»‹a chá»‰. PhÃ­ giao hÃ ng: 15.000Ä‘ - 30.000Ä‘ tÃ¹y khu vá»±c.';
    }
    
    if (lowerMessage.includes('thanh toÃ¡n') || lowerMessage.includes('payment') || lowerMessage.includes('pay')) {
        return 'ğŸ’³ ChÃºng tÃ´i há»— trá»£ 2 phÆ°Æ¡ng thá»©c thanh toÃ¡n:\n1. ğŸ’µ Thanh toÃ¡n khi nháº­n hÃ ng (COD)\n2. ğŸ¦ Chuyá»ƒn khoáº£n ngÃ¢n hÃ ng\nBáº¡n cÃ³ thá»ƒ chá»n phÆ°Æ¡ng thá»©c phÃ¹ há»£p khi Ä‘áº·t hÃ ng!';
    }
    
    if (lowerMessage.includes('dinh dÆ°á»¡ng') || lowerMessage.includes('nutrition') || lowerMessage.includes('thÃ nh pháº§n')) {
        return 'ğŸŒ± Sáº£n pháº©m cá»§a chÃºng tÃ´i Ä‘Æ°á»£c náº¥u tá»« nguyÃªn liá»‡u tÆ°Æ¡i sáº¡ch, Ä‘áº£m báº£o Ä‘áº§y Ä‘á»§ dinh dÆ°á»¡ng cho bÃ©. Má»—i mÃ³n chÃ¡o Ä‘á»u cÃ³ thÃ´ng tin chi tiáº¿t vá» protein, carb vÃ  cháº¥t bÃ©o. Báº¡n cÃ³ thá»ƒ xem táº¡i trang sáº£n pháº©m!';
    }
    
    if (lowerMessage.includes('Ä‘á»™ tuá»•i') || lowerMessage.includes('age') || lowerMessage.includes('tuá»•i')) {
        return 'ğŸ‘¶ ChÃºng tÃ´i cÃ³ thá»±c Ä‘Æ¡n phÃ¹ há»£p cho cÃ¡c Ä‘á»™ tuá»•i:\n- 6-8 thÃ¡ng: ChÃ¡o xay nhuyá»…n\n- 9-12 thÃ¡ng: ChÃ¡o Ä‘áº·c hÆ¡n\n- TrÃªn 1 tuá»•i: ChÃ¡o Ä‘áº§y Ä‘á»§ dinh dÆ°á»¡ng\nBáº¡n cÃ³ thá»ƒ chá»n mÃ³n phÃ¹ há»£p vá»›i Ä‘á»™ tuá»•i cá»§a bÃ©!';
    }
    
    if (lowerMessage.includes('liÃªn há»‡') || lowerMessage.includes('contact') || lowerMessage.includes('hotline')) {
        return 'ğŸ“ Báº¡n cÃ³ thá»ƒ liÃªn há»‡ vá»›i chÃºng tÃ´i qua:\n- Hotline: 1900 1234\n- Email: babycutie@gmail.com\n- Hoáº·c truy cáº­p trang LiÃªn há»‡ Ä‘á»ƒ gá»­i tin nháº¯n trá»±c tiáº¿p!';
    }
    
    if (lowerMessage.includes('khuyáº¿n mÃ£i') || lowerMessage.includes('promotion') || lowerMessage.includes('sale') || lowerMessage.includes('giáº£m giÃ¡')) {
        return 'ğŸ‰ ChÃºng tÃ´i thÆ°á»ng xuyÃªn cÃ³ cÃ¡c chÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i háº¥p dáº«n! HÃ£y theo dÃµi trang web hoáº·c fanpage Ä‘á»ƒ khÃ´ng bá» lá»¡ cÃ¡c Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t. KhÃ¡ch hÃ ng má»›i sáº½ nháº­n Ä‘Æ°á»£c Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t!';
    }
    
    if (lowerMessage.includes('chÃ o') || lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('xin chÃ o')) {
        return 'Xin chÃ o! ğŸ‘‹ TÃ´i ráº¥t vui Ä‘Æ°á»£c há»— trá»£ báº¡n. Báº¡n cÃ³ cÃ¢u há»i gÃ¬ vá» sáº£n pháº©m, Ä‘áº·t hÃ ng hay dá»‹ch vá»¥ cá»§a BabyCutie khÃ´ng?';
    }
    
    if (lowerMessage.includes('cáº£m Æ¡n') || lowerMessage.includes('thank') || lowerMessage.includes('thanks')) {
        return 'KhÃ´ng cÃ³ gÃ¬! ğŸ˜Š Náº¿u báº¡n cÃ³ thÃªm cÃ¢u há»i nÃ o khÃ¡c, Ä‘á»«ng ngáº§n ngáº¡i há»i tÃ´i nhÃ©. ChÃºc báº¡n vÃ  bÃ© yÃªu má»™t ngÃ y tá»‘t lÃ nh! â¤ï¸';
    }
    
    // Default response
    return 'Xin lá»—i, tÃ´i chÆ°a hiá»ƒu rÃµ cÃ¢u há»i cá»§a báº¡n. ğŸ˜… Báº¡n cÃ³ thá»ƒ há»i tÃ´i vá»:\n- ğŸ’° GiÃ¡ sáº£n pháº©m\n- ğŸ›’ CÃ¡ch Ä‘áº·t hÃ ng\n- ğŸšš Thá»i gian giao hÃ ng\n- ğŸ’³ PhÆ°Æ¡ng thá»©c thanh toÃ¡n\n- ğŸ“ ThÃ´ng tin liÃªn há»‡\nHoáº·c báº¡n cÃ³ thá»ƒ gá»i hotline 1900 1234 Ä‘á»ƒ Ä‘Æ°á»£c tÆ° váº¥n trá»±c tiáº¿p!';
}

// Add typing animation CSS
const style = document.createElement('style');
style.textContent = `
    @keyframes typing {
        0%, 60%, 100% {
            opacity: 0.3;
        }
        30% {
            opacity: 1;
        }
    }
`;
document.head.appendChild(style);
</script>

</body>
</html>
