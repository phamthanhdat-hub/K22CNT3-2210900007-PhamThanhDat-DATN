<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>BabyCutie ‚Äì Ch√°o dinh d∆∞·ª°ng cho b√©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/thuc-don.css">
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="header">
    <div class="container header-wrap">

        <!-- LOGO -->
        <div class="logo" onclick="window.location='index.html'">
            <img src="images/logo2.jpg" alt="BabyCutie">
            <span>BabyCutie</span>
        </div>

        <!-- SEARCH -->
        <div class="search">
            <i class="fa fa-search" id="searchIcon" onclick="handleSearch(event)"></i>
            <input type="text" id="searchInput" placeholder="T√¨m m√≥n ƒÉn cho b√©..." onkeyup="handleSearch(event)">
        </div>

        <!-- MENU -->
        <nav class="main-menu">
            <a href="index.html">Trang ch·ªß</a>
            <a href="thuc-don.html" class="active">Th·ª±c ƒë∆°n</a>
            <a href="tin-tuc.html">Tin t·ª©c</a>
            <a href="lien-he.html">Li√™n h·ªá</a>
        </nav>

        <!-- CART -->
        <div class="cart-icon" onclick="window.location='gio-hang.html'">
            <i class="fa-solid fa-cart-shopping"></i>
            <span class="cart-count" id="cartCount">0</span>
        </div>

        <!-- LOGIN / USER INFO -->
        <div class="login-group">
            <div id="userInfo" style="display: none;">
                <div class="dropdown">
                    <button class="btn-login dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fa fa-user"></i> <span id="userName"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="don-hang-cua-toi.html">üì¶ ƒê∆°n h√†ng c·ªßa t√¥i</a></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()">ƒêƒÉng xu·∫•t</a></li>
                    </ul>
                </div>
            </div>
            <div id="loginBtn">
                <div class="dropdown">
                    <button class="btn-login dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fa fa-user"></i> ƒêƒÉng nh·∫≠p
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="login-khach.html">
                                üë®‚Äçüë©‚Äçüëß Kh√°ch h√†ng
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="login-admin.html">
                                üõ† Admin
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
</header>
<!-- ================= MAIN ================= -->
<section class="menu-page">
    <div class="container">

        <!-- üîΩ C·∫§U TR√öC ROW CHU·∫®N CHO JS -->
        <div class="row">

            <!-- ================= FILTER (C·ªòT TR√ÅI) ================= -->
            <aside class="col-md-3 filter-box">
                <h5>‚ò∞ B·ªô l·ªçc</h5>

                <div class="filter-group">
                    <h6>Danh m·ª•c</h6>
                    <label>
                        <input type="radio" name="danhMuc" value="chao-thit" data-danhmuc="thit">
                        <span>üçñ Ch√°o th·ªãt</span>
                    </label>
                    <label>
                        <input type="radio" name="danhMuc" value="chao-ca" data-danhmuc="ca">
                        <span>üêü Ch√°o c√°</span>
                    </label>
                    <label>
                        <input type="radio" name="danhMuc" value="chao-dinh-duong" data-danhmuc="dinh-duong">
                        <span>ü•£ Ch√°o dinh d∆∞·ª°ng</span>
                    </label>
                </div>

                <div class="filter-group">
                    <h6>ƒê·ªô tu·ªïi ph√π h·ª£p</h6>
                    <label><input type="radio" name="age" value="6-12"> 6 ‚Äì 12 th√°ng</label>
                    <label><input type="radio" name="age" value="1-3"> 1 ‚Äì 3 tu·ªïi</label>
                </div>

                <div class="filter-group">
                    <h6>Kho·∫£ng gi√°</h6>
                    <label><input type="radio" name="gia" value="duoi30"> D∆∞·ªõi 30.000ƒë</label>
                    <label><input type="radio" name="gia" value="30-50"> 30.000ƒë ‚Äì 50.000ƒë</label>
                    <label><input type="radio" name="gia" value="tren50"> Tr√™n 50.000ƒë</label>
                    <button class="btn-reset-filter" onclick="resetFilters()" style="margin-top: 10px; width: 100%; padding: 8px; background: #f0f0f0; border: none; border-radius: 12px; cursor: pointer; font-size: 13px; color: #666;">
                        <i class="fa fa-refresh"></i> X√≥a b·ªô l·ªçc
                    </button>
                </div>

                <div class="combo-box">
                    <p><b>Combo ti·∫øt ki·ªám</b></p>
                    <p>Gi·∫£m 15% ƒë∆°n ƒë·∫ßu ti√™n</p>
                    <button class="btn-primary">Xem ngay</button>
                </div>
            </aside>

            <!-- ================= PRODUCT LIST (C·ªòT PH·∫¢I) ================= -->
            <main class="col-md-9">

                <!-- TITLE -->
                <div class="menu-head">
                    <div>
                        <h3>Th·ª±c ƒë∆°n ch√°o dinh d∆∞·ª°ng</h3>
                        <p>H∆∞∆°ng v·ªã t·ª± nhi√™n, tr·ªçn v·∫πn y√™u th∆∞∆°ng</p>
                    </div>
                    <select id="sortSelect">
                        <option value="pho-bien">Ph·ªï bi·∫øn nh·∫•t</option>
                        <option value="gia-thap-cao">Gi√° th·∫•p ‚Üí cao</option>
                        <option value="gia-cao-thap">Gi√° cao ‚Üí th·∫•p</option>
                        
                    </select>
                </div>

                <!-- üîΩ JS S·∫º RENDER S·∫¢N PH·∫®M ·ªû ƒê√ÇY -->
                <div class="row g-4" id="productGrid">
                    <!-- s·∫£n ph·∫©m t·ª´ API -->
                </div>

            </main>
        </div>
    </div>
</section>

<!-- ================= FOOTER ================= -->
<footer class="footer">
    <div class="container footer-wrap">
        <div>
            <b>BabyCutie</b>
            <p>Ch√°o dinh d∆∞·ª°ng cho b√© y√™u</p>
        </div>
        <div>
            <p>üìû Hotline: 1900 1234</p>
            <p>üìß babycutie@gmail.com</p>
        </div>
    </div>
</footer>

<!-- ================= TOAST NOTIFICATION ================= -->
<div id="toast" class="toast-notification"></div>

<!-- ================= JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/thuc-don.js"></script>
<script>
// Ki·ªÉm tra ƒëƒÉng nh·∫≠p v√† hi·ªÉn th·ªã th√¥ng tin
const token = localStorage.getItem("token");
const userInfo = JSON.parse(localStorage.getItem("user_info") || '{}');

if (token && userInfo.hoTen) {
    document.getElementById("userInfo").style.display = "block";
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("userName").textContent = userInfo.hoTen;
} else {
    document.getElementById("userInfo").style.display = "none";
    document.getElementById("loginBtn").style.display = "block";
}

function logout() {
    localStorage.removeItem("token");
    localStorage.removeItem("user_info");
    showToast("ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng", "info");
    setTimeout(() => {
        location.reload();
    }, 1000);
}

// X·ª≠ l√Ω search t·ª´ URL khi load trang
function handleSearchFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    const searchKeyword = urlParams.get('search');
    
    if (searchKeyword) {
        // ƒê·∫∑t gi√° tr·ªã v√†o input search
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.value = searchKeyword;
        }
        
        // ƒê·ª£i s·∫£n ph·∫©m load xong r·ªìi filter
        setTimeout(() => {
            const keyword = searchKeyword.toLowerCase();
            const allProducts = window.allProducts || danhSachSanPham || [];
            const ketQua = allProducts.filter(sp => 
                sp.tenSanPham.toLowerCase().includes(keyword) ||
                (sp.moTa && sp.moTa.toLowerCase().includes(keyword))
            );
            
            if (ketQua.length > 0) {
                hienThiSanPham(ketQua);
            } else {
                const khuVuc = document.querySelector(".col-md-9 .row");
                if (khuVuc) {
                    khuVuc.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="fa fa-search" style="font-size: 3rem; color: #ccc; margin-bottom: 20px;"></i>
                            <h4>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</h4>
                            <p class="text-muted">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o ph√π h·ª£p v·ªõi t·ª´ kh√≥a "<strong>${searchKeyword}</strong>"</p>
                            <button class="btn btn-primary mt-3" onclick="window.location='thuc-don.html'">
                                Xem t·∫•t c·∫£ s·∫£n ph·∫©m
                            </button>
                        </div>
                    `;
                }
            }
        }, 500);
    }
}

// Ch·ªù DOM ready v√† s·∫£n ph·∫©m load xong
document.addEventListener('DOMContentLoaded', () => {
    // X·ª≠ l√Ω search t·ª´ URL sau khi s·∫£n ph·∫©m ƒë√£ load
    setTimeout(() => {
        handleSearchFromURL();
    }, 1000);
});
</script>

</body>
</html>
